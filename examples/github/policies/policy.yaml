---
# sample policy for validating repositories
version: v1
type: pipeline-policy
name: acme-github-policy
context:
  group: Root Group
  provider: github
repository:
  - context: repo
    rules:
      - property: static_checks.secrets_in_repo
        value: true
      - property: static_checks.secrets_in_pull_request
        value: true
  - context: branch_protection
    params:
      branch_pattern: main
    rules:
      - property: policy.allow_force_push
        value: false
      - property: policy.allow_deletions
        value: false
      - property: policy.require_code_owner_review
        value: true
      - property: policy.required_reviewer_count
        value: 1
      # don't set policy.require_linear_history, we are okay without it
      - property: policy.requir_rereview_on_push
        value: true
artifact:
  - context: artifact_version
    params:
      tag: main
    rules:
      - property: signature.exists
        value: true
      - property: signature.verified
        value: true
      - property: signature.metadata[WorkflowName]
        value: "myorg/myrepo/myworkflow"
      - property: signature.metadata[WorkflowTrigger]
        glob: "something*" # prefix match
      - property: signature.metadata[WorkflowSha]
        exists: true
build_environment:
  - context: build
    rules:
      - property: permissions.dependencies_allowed.global_setting
        value: local_only

# ====================
# Previous Spitballing
# ====================

# build_environment:
#   - rules:  # Not specifying a context takes the default context
#       - type: no_org_wide_github_action_permissions
#         def:
#           enabled: true
# artifact:
#   - context: github
#     rules:
#       - type: ctlog_entry
#         params:
#           rekor: 'https://rekor.acme.dev/'
#           fulcio: 'https://fulcio.acme.dev/'
#           tuf: 'https://tuf.acme.dev/'
#         def:
#           state: exists
#   - context: quay
#     rules:
#       - type: ctlog_entry
#         params:
#           rekor: 'https://rekor.acme.dev/'
#           fulcio: 'https://fulcio.acme.dev/'
#           tuf: 'https://tuf.acme.dev/'
#         def:
#           state: exists
