# You can run these tests with:
# `fga model test --tests ./auth/tests/simple.tests.yaml`
#
# Unfortunately, the FGA CLI installation through `go get` produces a binary called `cli`
# So I didn't automate running this yet.

name: Auth tests
model_file: ../model.fga

tuples:
- user: project:001
  relation: parent
  object: project:002
- user: project:001
  relation: parent
  object: project:003

- user: user:admin1
  relation: admin
  object: project:001
- user: user:admin2
  relation: admin
  object: project:001
- user: user:nonadmin1
  relation: viewer
  object: project:001
- user: user:nonadmin1
  relation: editor
  object: project:002
- user: user:nonadmin1
  relation: admin
  object: project:003
- user: user:otherproject
  relation: admin
  object: project:010

tests:
- name: check-inheritance
  check:
  - user: user:admin1
    object: project:001
    assertions:
      creator: true
      viewer: true
      repo_updater: true
      provider_creator: true
      artifact_updater: true
  - user: user:admin1
    object: project:002
    assertions:
      creator: true
      viewer: true
      repo_updater: true
      provider_creator: true
      artifact_updater: true
  - user: user:admin2
    object: project:001
    assertions:
      creator: true
      viewer: true
      repo_updater: true
      provider_creator: true
      artifact_updater: true
  - user: user:admin2
    object: project:003
    assertions:
      creator: true
      viewer: true
      repo_updater: true
      provider_creator: true
      artifact_updater: true
  - user: user:nonadmin1
    object: project:001
    assertions:
      creator: false
      viewer: true
      repo_updater: false
      provider_creator: false
      artifact_updater: false
      provider_getter: true
  - user: user:nonadmin1
    object: project:002  # editor
    assertions:
      creator: false
      viewer: true
      repo_updater: true
      provider_creator: false
      artifact_updater: true
      provider_getter: true
  - user: user:nonadmin1
    object: project:003  # admin
    assertions:
      creator: true
      viewer: true
      repo_updater: true
      provider_creator: true
      artifact_updater: true
      provider_getter: true
  - user: user:otherproject
    object: project:003  # no role
    assertions:
      creator: false
      viewer: false
      repo_updater: false
      provider_creator: false
      artifact_updater: false
      provider_getter: false
  - user: user:otherproject
    object: project:010  # admin
    assertions:
      creator: true
      viewer: true
      repo_updater: true
      provider_creator: true
      artifact_updater: true
      provider_getter: true

