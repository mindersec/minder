# You can run these tests with:
# `fga model test --tests ./auth/tests/simple.tests.yaml`
#
# Unfortunately, the FGA CLI installation through `go get` produces a binary called `cli`
# So I didn't automate running this yet.

name: Auth tests
model_file: ../model.fga

tuples:
- user: project:001
  relation: parent
  object: project:002

# Set up two groups: org1-admin and org1-users; all users are members of org1-users
- user: user:admin1-a
  relation: admin
  object: group:org1-admin
- user: user:admin1-m
  relation: member
  object: group:org1-admin
- user: group:org1-admin#member
  relation: admin
  object: group:org1-users
- user: user:user1-a
  relation: member
  object: group:org1-users

# Just two memberships: org1-admin is admin over project 1, and org1-users is an editor of project 2
- user: group:org1-users#member
  relation: editor
  object: project:002
- user: group:org1-admin#member
  relation: admin
  object: project:001

tests:
- name: check-groups
  check:
  - user: user:admin1-a
    object: group:org1-admin
    assertions:
      member: true
      admin: true
  - user: user:admin1-m
    object: group:org1-admin
    assertions:
      member: true
      admin: false
  - user: user:admin1-m
    object: group:org1-users
    assertions:
      member: true
      admin: true
  - user: user:user1-a
    object: group:org1-users
    assertions:
      member: true
      admin: false
- name: check-projects
  check:
  - user: user:admin1-a
    object: project:002
    assertions:
      creator: true
      viewer: true
      repo_updater: true
      provider_creator: true
      artifact_updater: true
  - user: user:admin1-m
    object: project:002
    assertions:
      creator: true
      viewer: true
      repo_updater: true
      provider_creator: true
      artifact_updater: true
  - user: user:user1-a
    object: project:001
    assertions:
      creator: false
      viewer: false
      repo_updater: false
      provider_creator: false
      artifact_updater: false
  - user: user:user1-a
    object: project:002
    assertions:
      creator: false
      viewer: true
      repo_updater: true
      provider_creator: false
      artifact_updater: true
      provider_getter: true