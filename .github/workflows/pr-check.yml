name: Pull Request Validation

on:
  pull_request:
    types: [ opened, edited, reopened ]

jobs:
  check-pr-content:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR for Change Type selection
        uses: actions/github-script@v7
        with:
          script: |
            const { pull_request: { number: prNumber }, repository: { owner: { login: owner }, name: repo } } = context.payload;            
            const token = process.env.GITHUB_TOKEN;
            const octokit = github.getOctokit(token);
            
            octokit.rest.pulls.get({
              owner,
              repo,
              pull_number: prNumber,
            }).then(({data}) => {
              const body = data.body;
            
              // Check for Change Type
              const changeTypeRegex = /\- \[[xX]\] (Bug fix|Feature|Breaking change|Documentation)/;
              if (!changeTypeRegex.test(body)) {
                core.setFailed("You must select at least one Change Type.");
              }
            }).catch(error => {
              core.setFailed(`An error occurred: ${error.message}`);
            });
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
