//
// Copyright 2023 Stacklok, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";
package minder.v1;
import "google/api/annotations.proto";
import "google/protobuf/descriptor.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/field_mask.proto";

option go_package = "github.com/stacklok/minder/pkg/api/protobuf/go/minder/v1";

enum ObjectOwner {
    OBJECT_OWNER_UNSPECIFIED = 0;
    OBJECT_OWNER_PROJECT = 2;
    OBJECT_OWNER_USER = 3;
    reserved 1; // deprecated OBJECT_OWNER_ORGANIZATION
}

enum Relation {
    RELATION_UNSPECIFIED = 0;
    RELATION_CREATE = 1 [(name) = "create"];
    RELATION_GET = 2 [(name) = "get"];
    RELATION_UPDATE = 3 [(name) = "update"];
    RELATION_DELETE = 4 [(name) = "delete"];
    RELATION_ROLE_LIST = 5 [(name) = "role_list"];
    RELATION_ROLE_ASSIGNMENT_LIST = 6 [(name) = "role_assignment_list"];
    RELATION_ROLE_ASSIGNMENT_CREATE = 7 [(name) = "role_assignment_create"];
    RELATION_ROLE_ASSIGNMENT_REMOVE = 8 [(name) = "role_assignment_remove"];
    RELATION_REPO_GET = 9 [(name) = "repo_get"];
    RELATION_REPO_CREATE = 10 [(name) = "repo_create"];
    RELATION_REPO_UPDATE = 11 [(name) = "repo_update"];
    RELATION_REPO_DELETE = 12 [(name) = "repo_delete"];
    RELATION_ARTIFACT_GET = 13 [(name) = "artifact_get"];
    RELATION_ARTIFACT_CREATE = 14 [(name) = "artifact_create"];
    RELATION_ARTIFACT_UPDATE = 15 [(name) = "artifact_update"];
    RELATION_ARTIFACT_DELETE = 16 [(name) = "artifact_delete"];
    RELATION_PR_GET = 17 [(name) = "pr_get"];
    RELATION_PR_CREATE = 18 [(name) = "pr_create"];
    RELATION_PR_UPDATE = 19 [(name) = "pr_update"];
    RELATION_PR_DELETE = 20 [(name) = "pr_delete"];
    RELATION_PROVIDER_GET = 21 [(name) = "provider_get"];
    RELATION_PROVIDER_CREATE = 22 [(name) = "provider_create"];
    RELATION_PROVIDER_UPDATE = 23 [(name) = "provider_update"];
    RELATION_PROVIDER_DELETE = 24 [(name) = "provider_delete"];
    RELATION_RULE_TYPE_GET = 25 [(name) = "rule_type_get"];
    RELATION_RULE_TYPE_CREATE = 26 [(name) = "rule_type_create"];
    RELATION_RULE_TYPE_UPDATE = 27 [(name) = "rule_type_update"];
    RELATION_RULE_TYPE_DELETE = 28 [(name) = "rule_type_delete"];
    RELATION_PROFILE_GET = 29 [(name) = "profile_get"];
    RELATION_PROFILE_CREATE = 30 [(name) = "profile_create"];
    RELATION_PROFILE_UPDATE = 31 [(name) = "profile_update"];
    RELATION_PROFILE_DELETE = 32 [(name) = "profile_delete"];
    RELATION_PROFILE_STATUS_GET = 33 [(name) = "profile_status_get"];
    RELATION_REMOTE_REPO_GET = 34 [(name) = "remote_repo_get"];
    RELATION_ENTITY_RECONCILIATION_TASK_CREATE = 35 [(name) = "entity_reconciliation_task_create"];
    RELATION_ENTITY_RECONCILE = 36 [(name) = "entity_reconcile"];
    RELATION_ROLE_ASSIGNMENT_UPDATE = 37 [(name) = "role_assignment_update"];
}

extend google.protobuf.EnumValueOptions {
    optional string name = 42445;
}

enum TargetResource {
    TARGET_RESOURCE_UNSPECIFIED = 0;
    TARGET_RESOURCE_NONE = 1;
    TARGET_RESOURCE_USER = 2;
    TARGET_RESOURCE_PROJECT = 3;
}

message RpcOptions {
    bool no_log = 2;
    TargetResource target_resource = 6;
    Relation relation = 7;
    reserved 1, 3, 4, 5; // deprecated anonymous, owner_only, root_admin_only and auth_scope
}

extend google.protobuf.MethodOptions {
    RpcOptions rpc_options = 51077;
}

// Cursor message to be used in request messages. Its purpose is to
// allow clients to specify the subset of records to retrieve by means
// of index within a collection, along with the number of items to
// retrieve.
message Cursor {
    // cursor is the index to start from within the collection being
    // retrieved. It's an opaque payload specified and interpreted on
    // an per-rpc basis.
    string cursor = 1;
    // size is the number of items to retrieve from the collection.
    uint32 size = 2;
}

// CursorPage message used in response messages. Its purpose is to
// send to clients links pointing to next and/or previous collection
// subsets with respect to the one containing this struct.
message CursorPage {
    // Total number of records matching the request. This is optional.
    uint32 total_records = 1;
    // Cursor pointing to retrieve results logically placed after the
    // ones shipped with the message containing this struct.
    Cursor next = 2;
    // Cursor pointing to retrieve results logically placed before the
    // ones shipped with the message containing this struct.
    Cursor prev = 3;
}

// Simple Health Check Service
// replies with OK
service HealthService {
    rpc CheckHealth (CheckHealthRequest) returns (CheckHealthResponse) {
        option (google.api.http) = {
            get: "/api/v1/health"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_NONE
            no_log: true
        };
    }
}

service ArtifactService {
    rpc ListArtifacts (ListArtifactsRequest) returns (ListArtifactsResponse) {
        option (google.api.http) = {
            get: "/api/v1/artifacts/{provider}"
            additional_bindings {
                get: "/api/v1/artifacts"
            }
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ARTIFACT_GET
        };
    }

    rpc GetArtifactById (GetArtifactByIdRequest) returns (GetArtifactByIdResponse) {
        option (google.api.http) = {
            get: "/api/v1/artifact/{id}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ARTIFACT_GET
        };
    }

    rpc GetArtifactByName (GetArtifactByNameRequest) returns (GetArtifactByNameResponse) {
        option (google.api.http) = {
            get: "/api/v1/artifact/name/{name=**}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ARTIFACT_GET
        };
    }

}

message ListArtifactsRequest {
    string provider = 1;
    Context context = 3;
    string from = 4;

    reserved 2; // deprecated project_id
}

message ListArtifactsResponse {
    repeated Artifact results = 1;
}

message Artifact {
    string artifact_pk = 1;
    string owner = 2;
    string name = 3;
    string type = 4;
    string visibility = 5;
    string repository = 6;
    repeated ArtifactVersion versions = 7;
    google.protobuf.Timestamp created_at = 8;
    Context context = 9;
}

message ArtifactVersion {
    int64 version_id = 1;
    repeated string tags = 2;
    string sha = 3;
    google.protobuf.Timestamp created_at = 6;

    reserved 4, 5;
    reserved "github_workflow", "signature_verification";
}

message GetArtifactByIdRequest {
    string id = 1;

    Context context = 7;

    reserved 5, 6; // deprecated latest_versions, tag
    reserved "latest_versions", "tag";
}

message GetArtifactByIdResponse {
    Artifact artifact = 1;
    repeated ArtifactVersion versions = 2;
}

message GetArtifactByNameRequest {
    string name = 1;
    Context context = 4;

    reserved 2, 3; // deprecated latest_versions, tag
    reserved "latest_versions", "tag";
}

message GetArtifactByNameResponse {
    Artifact artifact = 1;
    repeated ArtifactVersion versions = 2;
}

message PullRequest {
    string url = 1;         // The full URL to the PR
    string commit_sha = 2;  // Commit SHA of the PR HEAD. Will be useful to submit a review
    int64 number = 3;       // The sequential PR number (not the DB PK!)

    string repo_owner = 4;  // The owner of the repo, will be used to submit a review
    string repo_name = 5;   // The name of the repo, will be used to submit a review

    int64 author_id = 6;    // The author of the PR, will be used to check if we can request changes

    string action = 7;      // The action that triggered the webhook

    Context context = 8;
}

// Stubs for the SDLC entities
message Release {}
message PipelineRun {}
message TaskRun {}
message Build {}

service OAuthService {
    rpc GetAuthorizationURL (GetAuthorizationURLRequest) returns (GetAuthorizationURLResponse) {
        option (google.api.http) = {
            get: "/api/v1/auth/url"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_UPDATE
        };
    }

    rpc StoreProviderToken (StoreProviderTokenRequest) returns (StoreProviderTokenResponse) {
        option (google.api.http) = {
            post: "/api/v1/auth/{provider}/token"
            additional_bindings {
                post: "/api/v1/auth/token"
                body: "*"
            }
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_UPDATE
        };
    }

    // VerifyProviderTokenFrom verifies that a token has been created for a provider since given timestamp
    rpc VerifyProviderTokenFrom (VerifyProviderTokenFromRequest) returns (VerifyProviderTokenFromResponse) {
        option deprecated = true;
        option (google.api.http) = {
            get: "/api/v1/auth/verify/{provider}/{timestamp}"
            additional_bindings {
                get: "/api/v1/auth/verify/{timestamp}"
            }
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_UPDATE
        };
    }

    // VerifyProviderCredential verifies that a credential has been created matching the enrollment nonce
    rpc VerifyProviderCredential (VerifyProviderCredentialRequest) returns (VerifyProviderCredentialResponse) {
        option (google.api.http) = {
            get: "/api/v1/auth/verify"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_UPDATE
        };
    }

}

service RepositoryService {
    rpc RegisterRepository (RegisterRepositoryRequest) returns (RegisterRepositoryResponse) {
        option (google.api.http) = {
            post: "/api/v1/repository/provider/{provider}/register"
            additional_bindings {
                post: "/api/v1/repository/register",
                body: "*"
            }
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_REPO_CREATE
        };
    }
    rpc ListRemoteRepositoriesFromProvider(ListRemoteRepositoriesFromProviderRequest) returns (ListRemoteRepositoriesFromProviderResponse) {
        option (google.api.http) = {
            get: "/api/v1/repositories/provider/{provider}/remote"
            additional_bindings {
                get: "/api/v1/repositories/remote"
            }
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_REMOTE_REPO_GET
        };
    }
    rpc ListRepositories (ListRepositoriesRequest) returns (ListRepositoriesResponse) {
        option (google.api.http) = {
            get: "/api/v1/repositories/provider/{provider}"
            additional_bindings {
                get: "/api/v1/repositories"
            }
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_REPO_GET
        };
    }
    rpc GetRepositoryById (GetRepositoryByIdRequest) returns (GetRepositoryByIdResponse) {
        option (google.api.http) = {
            get: "/api/v1/repository/id/{repository_id}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_REPO_GET
        };
    }

    rpc GetRepositoryByName (GetRepositoryByNameRequest) returns (GetRepositoryByNameResponse) {
        option (google.api.http) = {
            get: "/api/v1/repository/provider/{provider}/name/{name=**}"
            additional_bindings {
                get: "/api/v1/repository/name/{name=**}"
            }
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_REPO_GET
        };
    }

    rpc DeleteRepositoryById (DeleteRepositoryByIdRequest) returns (DeleteRepositoryByIdResponse) {
        option (google.api.http) = {
            delete: "/api/v1/repository/id/{repository_id}"
        };

        option (minder.v1.rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_REPO_DELETE
        };
    }

    rpc DeleteRepositoryByName (DeleteRepositoryByNameRequest) returns (DeleteRepositoryByNameResponse) {
        option (google.api.http) = {
            delete: "/api/v1/repository/provider/{provider}/name/{name=**}"
            additional_bindings {
                delete: "/api/v1/repository/name/{name=**}"
            }
        };

        option (minder.v1.rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_REPO_DELETE
        };
    }
}

// manage Users CRUD
service UserService {
    rpc CreateUser (CreateUserRequest) returns (CreateUserResponse) {
        option (google.api.http) = {
            post: "/api/v1/user"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_USER
        };
    }

    rpc DeleteUser (DeleteUserRequest) returns (DeleteUserResponse) {
        option (google.api.http) = {
            delete: "/api/v1/user"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_USER
        };
    }

    rpc GetUser (GetUserRequest) returns (GetUserResponse) {
        option (google.api.http) = {
            get: "/api/v1/user"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_USER
        };
    }

    // ListInvitations returns a list of invitations for the user
    // based on the user's registered email address.  Note that a
    // user who receives an invitation code may still accept the
    // invitation even if the code was directed to a different
    // email address.  This is because understanding the routing of
    // email messages is beyond the scope of Minder.
    //
    // This API endpoint may be called without the logged-in user
    // previously having called `CreateUser`.
    rpc ListInvitations (ListInvitationsRequest) returns (ListInvitationsResponse) {
        option (google.api.http) = {
            get: "/api/v1/user/invitations"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_USER
        };
    }

    // ResolveInvitation allows a user to accept or decline an
    // invitation to a project given the code for the invitation.
    // A user may call ResolveInvitation to accept or decline an
    // invitation even if they have not called CreateUser.  If a
    // user accepts an invitation via this call before calling
    // CreateUser, a Minder user record will be created, but no
    // additional projects will be created (unlike CreateUser,
    // which will also create a default project).
    rpc ResolveInvitation (ResolveInvitationRequest) returns (ResolveInvitationResponse) {
        option (google.api.http) = {
            post: "/api/v1/user/invitation/{code}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_USER
        };
    }
}

service ProfileService {
    rpc CreateProfile (CreateProfileRequest) returns (CreateProfileResponse) {
        option (google.api.http) = {
            post: "/api/v1/profile"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_CREATE
        };
    }

    rpc UpdateProfile (UpdateProfileRequest) returns (UpdateProfileResponse) {
        option (google.api.http) = {
            put: "/api/v1/profile"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_UPDATE
        };
    }

    rpc PatchProfile (PatchProfileRequest) returns (PatchProfileResponse) {
        option (google.api.http) = {
            patch: "/api/v1/profile/{id}"
            body: "patch"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_UPDATE
        };
    }

    rpc DeleteProfile (DeleteProfileRequest) returns (DeleteProfileResponse) {
        option (google.api.http) = {
            delete: "/api/v1/profile/{id}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_DELETE
        };
    }

    rpc ListProfiles (ListProfilesRequest) returns (ListProfilesResponse) {
        option (google.api.http) = {
            get: "/api/v1/profiles"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_GET
        };
    }

    rpc GetProfileById (GetProfileByIdRequest) returns (GetProfileByIdResponse) {
        option (google.api.http) = {
            get: "/api/v1/profile/{id}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_GET
        };
    }

    rpc GetProfileStatusByName (GetProfileStatusByNameRequest) returns (GetProfileStatusByNameResponse) {
        option (google.api.http) = {
            get: "/api/v1/profile/name/{name=**}/status"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_STATUS_GET
        };
    }

    rpc GetProfileStatusByProject (GetProfileStatusByProjectRequest) returns (GetProfileStatusByProjectResponse) {
        option (google.api.http) = {
            get: "/api/v1/profile_status"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_STATUS_GET
        };
    }    

    rpc ListRuleTypes (ListRuleTypesRequest) returns (ListRuleTypesResponse) {
        option (google.api.http) = {
            get: "/api/v1/rule_types"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_RULE_TYPE_GET
        };
    }

    rpc GetRuleTypeByName (GetRuleTypeByNameRequest) returns (GetRuleTypeByNameResponse) {
        option (google.api.http) = {
            get: "/api/v1/rule_type/name/{name=**}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_RULE_TYPE_GET
        };
    }

    rpc GetRuleTypeById (GetRuleTypeByIdRequest) returns (GetRuleTypeByIdResponse) {
        option (google.api.http) = {
            get: "/api/v1/rule_type/{id}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_RULE_TYPE_GET
        };
    }

    rpc CreateRuleType (CreateRuleTypeRequest) returns (CreateRuleTypeResponse) {
        option (google.api.http) = {
            post: "/api/v1/rule_type"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_RULE_TYPE_CREATE
        };
    }

    rpc UpdateRuleType (UpdateRuleTypeRequest) returns (UpdateRuleTypeResponse) {
        option (google.api.http) = {
            put: "/api/v1/rule_type"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_RULE_TYPE_UPDATE
        };
    }

    rpc DeleteRuleType (DeleteRuleTypeRequest) returns (DeleteRuleTypeResponse) {
        option (google.api.http) = {
            delete: "/api/v1/rule_type/{id}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_RULE_TYPE_DELETE
        };
    }
}

service EvalResultsService {
    rpc ListEvaluationResults(ListEvaluationResultsRequest) returns (ListEvaluationResultsResponse) {
        option (google.api.http) = {
            // TODO: use
            // get: "/api/v1/projects/{Context.project}/results"
            // If we can promote Context.project to not be optional
            get: "/api/v1/results"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_STATUS_GET
        };
    }

    rpc ListEvaluationHistory(ListEvaluationHistoryRequest) returns (ListEvaluationHistoryResponse) {
        option (google.api.http) = {
            get: "/api/v1/history"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROFILE_STATUS_GET
        };
    }
}

service PermissionsService {
    rpc ListRoles (ListRolesRequest) returns (ListRolesResponse) {
        option (google.api.http) = {
            get: "/api/v1/permissions/roles"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ROLE_LIST
        };
    }

    rpc ListRoleAssignments (ListRoleAssignmentsRequest) returns (ListRoleAssignmentsResponse) {
        option (google.api.http) = {
            get: "/api/v1/permissions/assignments"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ROLE_ASSIGNMENT_LIST
        };
    }

    rpc AssignRole (AssignRoleRequest) returns (AssignRoleResponse) {
        option (google.api.http) = {
            post: "/api/v1/permissions/assign"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ROLE_ASSIGNMENT_CREATE
        };
    }

    rpc UpdateRole(UpdateRoleRequest) returns (UpdateRoleResponse) {
        option (google.api.http) = {
            post: "/api/v1/permissions/update"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ROLE_ASSIGNMENT_UPDATE
        };
    }

    rpc RemoveRole (RemoveRoleRequest) returns (RemoveRoleResponse) {
        // The role name comes from the name field in the role object
        option (google.api.http) = {
            delete: "/api/v1/permissions/remove"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ROLE_ASSIGNMENT_REMOVE
        };
    }
}

service ProjectsService {

    rpc ListProjects(ListProjectsRequest) returns (ListProjectsResponse) {
        option (google.api.http) = {
            get: "/api/v1/projects"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_USER
            relation: RELATION_GET
        };
    }

    rpc CreateProject(CreateProjectRequest) returns (CreateProjectResponse) {
        option (google.api.http) = {
            post: "/api/v1/projects"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_CREATE
        };
    }

    rpc ListChildProjects(ListChildProjectsRequest) returns (ListChildProjectsResponse) {
        option (google.api.http) = {
            get: "/api/v1/projects/{context.project_id}/children"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_GET
        };
    }

    rpc DeleteProject(DeleteProjectRequest) returns (DeleteProjectResponse) {
        option (google.api.http) = {
            delete: "/api/v1/projects"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_DELETE
        };
    }

    rpc UpdateProject(UpdateProjectRequest) returns (UpdateProjectResponse) {
        option (google.api.http) = {
            put: "/api/v1/projects"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_UPDATE
        };
    }

    rpc PatchProject(PatchProjectRequest) returns (PatchProjectResponse) {
        option (google.api.http) = {
            patch: "/api/v1/projects"
            body: "patch"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_UPDATE
        };
    }

    rpc CreateEntityReconciliationTask(CreateEntityReconciliationTaskRequest) returns (CreateEntityReconciliationTaskResponse) {
        option (google.api.http) = {
            post: "/api/v1/projects/entity/reconcile"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ENTITY_RECONCILIATION_TASK_CREATE
        };
    }
}

service ProvidersService {
    rpc PatchProvider(PatchProviderRequest) returns (PatchProviderResponse) {
        option (google.api.http) = {
            patch: "/api/v1/providers"
            body: "patch"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_UPDATE
        };
    }

    rpc GetProvider(GetProviderRequest) returns (GetProviderResponse) {
        option (google.api.http) = {
            get: "/api/v1/providers/{name}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_GET
        };
    }

    rpc ListProviders (ListProvidersRequest) returns (ListProvidersResponse) {
        option (google.api.http) = {
            get: "/api/v1/providers"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_GET
        };
    }

    rpc CreateProvider (CreateProviderRequest) returns (CreateProviderResponse) {
        option (google.api.http) = {
            post: "/api/v1/providers"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_CREATE
        };
    }

    rpc DeleteProvider (DeleteProviderRequest) returns (DeleteProviderResponse) {
        option (google.api.http) = {
            // TODO: it would be nice to be able to use context.project and
            // context.provider here, but they are optional and cannot be used
            // in the path.  Change this for v2.
            delete: "/api/v1/providers"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_DELETE
        };
    }

    rpc DeleteProviderByID (DeleteProviderByIDRequest) returns (DeleteProviderByIDResponse) {
        option (google.api.http) = {
            delete: "/api/v1/providers/{id}"
        };

        option (minder.v1.rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_REPO_DELETE
        };
    }

    // GetUnclaimedProviders returns a list of known provider configurations
    // that this user could claim based on their identity.  This is a read-only
    // operation for use by clients which wish to present a menu of options.
    rpc GetUnclaimedProviders (GetUnclaimedProvidersRequest) returns (GetUnclaimedProvidersResponse) {
        option (google.api.http) = {
            get: "/api/v1/my/providers"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_USER
        };
    }

    rpc ListProviderClasses (ListProviderClassesRequest) returns (ListProviderClassesResponse) {
        option (google.api.http) = {
            get: "/api/v1/provider_classes"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_PROVIDER_GET
        };
    }

    rpc ReconcileEntityRegistration(ReconcileEntityRegistrationRequest) returns (ReconcileEntityRegistrationResponse) {
        option (google.api.http) = {
            post: "/api/v1/provider/register_all"
            body: "*"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_PROJECT
            relation: RELATION_ENTITY_RECONCILE
        };
    }
}

service InviteService {
    rpc GetInviteDetails(GetInviteDetailsRequest) returns (GetInviteDetailsResponse) {
        option (google.api.http) = {
            get: "/api/v1/invite/{code}"
        };

        option (rpc_options) = {
            target_resource: TARGET_RESOURCE_NONE
        };
    }
}

message GetInviteDetailsRequest {
    // Invite nonce/code to retrieve details for
    string code = 2;

    reserved 1; // deprecated Context context = 1;
    reserved "context";
}

message GetInviteDetailsResponse {
    // Project associated with the invite
    string project_display = 1;
    // Sponsor of the invite
    string sponsor_display = 2;
    // expires_at is the time at which the invitation expires.
    google.protobuf.Timestamp expires_at = 3;
    // expired is true if the invitation has expired
    bool expired = 4;
}

message CheckHealthRequest {
}

message CheckHealthResponse {
    string status = 1;
}

message GetAuthorizationURLRequest {
    bool  cli = 3;
    int32  port = 4;
    optional string owner = 5;
    Context context = 6;
    optional string redirect_url = 7;

    // config is a JSON object that can be used to pass additional configuration
    google.protobuf.Struct config = 8;

    string provider_class = 9;

    reserved 1, 2; // deprecated provider and project_id
}

message GetAuthorizationURLResponse {
    string url = 1;
    string state = 2;
}

message StoreProviderTokenRequest {
    string provider = 1 [deprecated=true];
    string access_token = 3;
    optional string owner = 4;
    Context context = 5;

    reserved 2; // deprecated project_id
}

message StoreProviderTokenResponse {    
}

// Project API Objects
message Project {
    string project_id = 1;
    string name = 3;
    string description = 4;
    google.protobuf.Timestamp created_at = 6;
    google.protobuf.Timestamp updated_at = 7;
    // display_name allows for a human-readable name to be used.
    // display_names are short *non-unique* strings to provide
    // a user-friendly name for presentation in lists, etc.
    string display_name = 5;
}

// Repositories API objects

message ListRemoteRepositoriesFromProviderRequest {
    string provider = 1 [deprecated=true];
    Context context = 3;

    reserved 2; // deprecated project_id
}

message ListRemoteRepositoriesFromProviderResponse {
    repeated UpstreamRepositoryRef results = 1;
}

message UpstreamRepositoryRef {
    string owner = 1;
    string name = 2;
    // The upstream identity of the repository, as an integer.
    // This is only set on output, and is ignored on input.
    int64 repo_id = 3;
    Context context = 4;
    // True if the repository is already registered in Minder.
    // This is only set on output, and is ignored on input.
    bool registered = 5;
}

message Repository {
    reserved 15;
    reserved "registered";
    optional string id = 1; // This is optional when returning remote repositories
    optional Context context = 2;
    string owner = 3;
    string name = 4;
    int64 repo_id = 5;
    int64 hook_id = 6;
    string hook_url = 7;
    string deploy_url = 8;
    string clone_url = 9;
    string hook_name = 10;
    string hook_type = 11;
    string hook_uuid = 12;
    bool is_private = 13;
    bool is_fork = 14;
    google.protobuf.Timestamp created_at = 16;
    google.protobuf.Timestamp updated_at = 17;
    string default_branch = 18;
    string license = 19;
}

message RegisterRepositoryRequest {
    string provider = 1 [deprecated=true];
    UpstreamRepositoryRef repository = 3;
    Context context = 4;

    reserved 2; // deprecated project_id
}

message RegisterRepoResult {
    message Status {
        bool success = 1;
        optional string error = 2;
    }

    Repository repository = 1;
    Status status = 2;
}

message RegisterRepositoryResponse {
    RegisterRepoResult result = 1;
}

message GetRepositoryByIdRequest {
    string repository_id = 1;
    Context context = 2;
}

message GetRepositoryByIdResponse {
    Repository repository = 1;
}

message DeleteRepositoryByIdRequest {
    string repository_id = 1;
    Context context = 2;
}

message DeleteRepositoryByIdResponse {
    string repository_id = 1;
}

message GetRepositoryByNameRequest {
    string provider = 1 [deprecated=true];
    string name = 3;
    Context context = 4;

    reserved 2; // deprecated project_id
}

message GetRepositoryByNameResponse {
    Repository repository = 1;
}

message DeleteRepositoryByNameRequest {
    string provider = 1 [deprecated=true];
    string name = 3;
    Context context = 4;

    reserved 2; // deprecated project_id
}

message DeleteRepositoryByNameResponse {
    string name = 1;
}

message ListRepositoriesRequest {
    string provider = 1 [deprecated=true];
    int64 limit = 3;
    Context context = 5;
    string cursor = 6;

    reserved 2,4; // deprecated project_id, offset
    reserved "project_id", "offset";
}

message ListRepositoriesResponse {
    repeated Repository results = 1;

    // cursor is the cursor to use for the next page of results, empty if at the end
    string cursor = 2;
}

message ReconcileEntityRegistrationRequest {
    Context context = 1;
    string entity = 2;
}

message ReconcileEntityRegistrationResponse {
}

message VerifyProviderTokenFromRequest {
    string provider = 1 [deprecated=true];
    google.protobuf.Timestamp timestamp = 3;
    Context context = 4;

    reserved 2; // deprecated project_id
}

message VerifyProviderTokenFromResponse {
    string status = 1;
}

// VerifyProviderCredentialRequest contains the enrollment nonce (aka state) that was used when enrolling the provider
message VerifyProviderCredentialRequest {
    Context context = 1;

    // enrollment_nonce is the state parameter returned when enrolling the provider
    string enrollment_nonce = 2;
}

// VerifyProviderCredentialRequest responds with a boolean indicating if the provider has been created and the provider
// name, if it has been created
message VerifyProviderCredentialResponse {
    bool created = 1;
    string provider_name = 2;
}

message BranchProtection {
  string branch = 1;
  bool is_protected = 2;
  // Add other relevant fields
}

// User service
message CreateUserRequest { }

message CreateUserResponse {
    int32 id = 1;
    string organization_id = 2 [deprecated=true];
    string organizatio_name =3 [deprecated=true];
    string project_id = 4;
    string project_name = 5;
    string identity_subject = 6;
    google.protobuf.Timestamp created_at = 7;
    Context context = 8;
}

message DeleteUserRequest {
    reserved 1; // deprecated context
}

message DeleteUserResponse {
}

// user record to be returned
message UserRecord {
    int32 id = 1;
    string identity_subject = 3;
    google.protobuf.Timestamp created_at = 4;
    google.protobuf.Timestamp updated_at = 5;

    reserved 2; // deprecated organization_id
    reserved "organization_id";
}

// ProjectRole has the project along with the role the user has in the project
message ProjectRole {
    Role role = 1;
    Project project = 2;
}

// get user
message GetUserRequest {
    reserved 1; // deprecated context
}

message GetUserResponse {
    optional UserRecord user = 1;
    // This will be deprecated in favor of the project_roles field
    repeated Project projects = 2 [deprecated=true];
    repeated ProjectRole project_roles = 3;
}

// Profile service
message CreateProfileRequest {
    Profile profile = 1;
    reserved 2; // deprecated context
}

message CreateProfileResponse {
    Profile profile = 1;
}

message UpdateProfileRequest {
    Profile profile = 1;
    reserved 2; // deprecated context
}

message UpdateProfileResponse {
    Profile profile = 1;
}

message PatchProfileRequest {
    // The context in which the patch is applied. Provided explicitly
    // so that the patch itself can be minimal and contain only
    // the attribute to set, e.g. remediate=true
    Context context = 1;
    // The id of the profile to patch. Same explanation about explicitness
    // as for the context
    string id = 2;
    // The patch to apply to the profile
    Profile patch = 3;
    // needed to enable PATCH, see https://grpc-ecosystem.github.io/grpc-gateway/docs/mapping/patch_feature/
    // is not exposed to the API user
    google.protobuf.FieldMask update_mask = 4;
}

message PatchProfileResponse {
    Profile profile = 1;
}

message DeleteProfileRequest {
    // context is the context in which the rule type is evaluated.
    Context context = 1;
    // id is the id of the profile to delete
    string id = 2;
}

message DeleteProfileResponse {
}

// list profiles
message ListProfilesRequest {
    // context is the context which contains the profiles
    Context context = 1;
    // Filter profiles to only those matching the specified labels.
    // 
    // The default is to return all user-created profiles; the string "*" can
    // be used to select all profiles, including system profiles.  This syntax
    // may be expanded in the future.
    string label_filter = 2;
}

message ListProfilesResponse {
    repeated Profile profiles = 1;
}

// get profile by id
message GetProfileByIdRequest {
    // context is the context which contains the profiles
    Context context = 1;
    // id is the id of the profile to get
    string id = 2;
}

message GetProfileByIdResponse {
    Profile profile = 1;
}

// get the overall profile status
message ProfileStatus {
    // profile_id is the id of the profile
    string profile_id = 1;
    // profile_name is the name of the profile
    string profile_name = 2;
    // profile_status is the status of the profile
    string profile_status = 3;
    // last_updated is the last time the profile was updated
    google.protobuf.Timestamp last_updated = 4;

    // profile_display_name is the display name of the profile
    string profile_display_name = 5;
}

// EvalResultAlert holds the alert details for a given rule evaluation
message EvalResultAlert {
    // status is the status of the alert
    string status = 1;
    // last_updated is the last time the alert was performed or attempted
    google.protobuf.Timestamp last_updated = 2;
    // details is the description of the alert attempt if any
    string details = 3;
    // url is the URL to the alert
    string url = 4;
}

// get the status of the rules for a given profile
message RuleEvaluationStatus {
    // profile_id is the id of the profile
    string profile_id = 1;
    // rule_id is the id of the rule
    string rule_id = 2;
    // rule_name is the type of the rule. Deprecated in favor of rule_type_name
    string rule_name = 3 [deprecated=true];
    // entity is the entity that was evaluated
    string entity = 4;
    // status is the status of the evaluation
    string status = 5;
    // last_updated is the last time the profile was updated
    google.protobuf.Timestamp last_updated = 6;
    // entity_info is the information about the entity
    map<string, string> entity_info = 7;
    // details is the description of the evaluation if any
    string details = 8;
    // guidance is the guidance for the evaluation if any
    string guidance = 9;
    // remediation_status is the status of the remediation
    string remediation_status = 10;
    // remediation_last_updated is the last time the remediation was performed or attempted
    optional google.protobuf.Timestamp remediation_last_updated = 11;
    // remediation_details is the description of the remediation attempt if any
    string remediation_details = 12;
    // rule_type_name is the name of the rule
    string rule_type_name = 13;
    // rule_description_name is the name to describe the rule
    string rule_description_name = 14;
    // alert holds the alert details if the rule generated an alert in an external system
    EvalResultAlert alert = 15;
    // severity is the severity of the rule
    Severity severity = 16;
    // rule_evaluation_id is the id of the rule evaluation
    string rule_evaluation_id = 17;
    // remediation_url is a url to get more data about a remediation, for PRs is the link to the PR
    string remediation_url = 18;
    // rule_display_name captures the display name of the rule 
    string rule_display_name = 19;
}

// EntiryTypeId is a message that carries an ID together with a type to uniquely identify an entity
// such as (repo, 1), (artifact, 2), ...
message EntityTypedId {
    // entity is the entity to get status for. Incompatible with `all`
    Entity type = 1;
    // id is the ID of the entity to get status for. Incompatible with `all`
    string id = 2;
}

message GetProfileStatusByNameRequest {
    // context is the context in which the rule type is evaluated.
    Context context = 1;
    // name is the name of the profile to get
    string name = 2;

    EntityTypedId entity = 3;
    bool all = 4;

    // rule is the type of the rule. Deprecated in favor of rule_type
    string rule = 5 [deprecated=true];
    string rule_type = 6;
    string rule_name = 7;
}

message GetProfileStatusByNameResponse {
    // profile_status is the status of the profile
    ProfileStatus profile_status = 1;

    // rule_evaluation_status is the status of the rules
    repeated RuleEvaluationStatus rule_evaluation_status = 2;
}

message GetProfileStatusByProjectRequest {
    // context is the context in which the rule type is evaluated.
    Context context = 1;
}

message GetProfileStatusByProjectResponse {
    // profile_status is the status of the profile
    repeated ProfileStatus profile_status = 1;
}

// Entity defines the entity that is supported by the provider.
enum Entity {
    ENTITY_UNSPECIFIED = 0;
    ENTITY_REPOSITORIES = 1;
    ENTITY_BUILD_ENVIRONMENTS = 2;
    ENTITY_ARTIFACTS = 3;
    ENTITY_PULL_REQUESTS = 4;
    ENTITY_RELEASE = 5;
    ENTITY_PIPELINE_RUN = 6;
    ENTITY_TASK_RUN = 7;
    ENTITY_BUILD = 8;
}

message EntityAutoRegistrationConfig {
   optional bool enabled = 1;
}

// AutoRegistration is the configuration for auto-registering entities.
// When nothing is set, it means that auto-registration is disabled. There is no difference between disabled
// and undefined so for the "let's not auto-register anything" case we'd just let the repeated string empty
message AutoRegistration {
    // enabled is the list of entities that are enabled for auto-registration.
    map<string, EntityAutoRegistrationConfig> entities = 1;
}

// ProviderConfig contains the generic configuration for a provider.
message ProviderConfig {
    // auto_registration is the configuration for auto-registering entities.
    optional AutoRegistration auto_registration = 1;
}

// RESTProviderConfig contains the configuration for the REST provider.
message RESTProviderConfig {
    // base_url is the base URL for the REST provider.
	optional string base_url = 1;
}

// GitHubProviderConfig contains the configuration for the GitHub client
//
// Endpoint: is the GitHub API endpoint
//
// If using the public GitHub API, Endpoint can be left blank
// disable revive linting for this struct as there is nothing wrong with the
// naming convention
message GitHubProviderConfig {
    // Endpoint is the GitHub API endpoint. If using the public GitHub API, Endpoint can be left blank.
	optional string endpoint = 1;
}

// GitHubAppProviderConfig contains the configuration for the GitHub App provider
message GitHubAppProviderConfig {
  // Endpoint is the GitHub API endpoint. If using the public GitHub API, Endpoint can be left blank.
  optional string endpoint = 1;
  reserved 2, 3, 4;
  reserved "app_name", "app_id", "user_id";
}

// DockerHubProviderConfig contains the configuration for the DockerHub provider.
//
// Namespace: is the namespace for the DockerHub provider.
//
message DockerHubProviderConfig {
    // namespace is the namespace for the DockerHub provider.
    optional string namespace = 1;
}

// GHCRProviderConfig contains the configuration for the GHCR provider.
//
// Namespace: is the namespace for the GHCR provider.
//
message GHCRProviderConfig {
    // namespace is the namespace for the GHCR provider.
    optional string namespace = 1;
}

// Context defines the context in which a rule is evaluated.
// this normally refers to a combination of the provider, organization and project.
message Context {
    // Removing the 'optional' keyword from the following two fields below will break
    // buf compatibility checks.

    // name of the provider
    optional string provider = 1;
    // ID of the project
    optional string project = 3;

    optional string retired_organization = 2;
}

// ContextV2 defines the context in which a rule is evaluated.
message ContextV2 {
    // project is the project ID
    string project_id = 1;

    // name of the provider. Set to empty string when not applicable.
    string provider = 2;
}

// --- START RuleType CRUD definitions

// ListRuleTypesRequest is the request to list rule types.
message ListRuleTypesRequest {
    // context is the context in which the rule types are evaluated.
    Context context = 1;
}

// ListRuleTypesResponse is the response to list rule types.
message ListRuleTypesResponse {
    // rule_types is the list of rule types.
    repeated RuleType rule_types = 1;
}

// GetRuleTypeByNameRequest is the request to get a rule type by name.
message GetRuleTypeByNameRequest {
    // context is the context in which the rule type is evaluated.
    Context context = 1;
    // name is the name of the rule type.
    string name = 2;
}

// GetRuleTypeByNameResponse is the response to get a rule type by name.
message GetRuleTypeByNameResponse {
    // rule_type is the rule type.
    RuleType rule_type = 1;
}

// GetRuleTypeByIdRequest is the request to get a rule type by id.
message GetRuleTypeByIdRequest {
    // context is the context in which the rule type is evaluated.
    Context context = 1;
    // id is the id of the rule type.
    string id = 2;
}

// GetRuleTypeByIdResponse is the response to get a rule type by id.
message GetRuleTypeByIdResponse {
    // rule_type is the rule type.
    RuleType rule_type = 1;
}

// CreateRuleTypeRequest is the request to create a rule type.
message CreateRuleTypeRequest {
    // rule_type is the rule type to be created.
    RuleType rule_type = 1;
    reserved 2; // deprecated context
}

// CreateRuleTypeResponse is the response to create a rule type.
message CreateRuleTypeResponse {
    // rule_type is the rule type that was created.
    RuleType rule_type = 1;
}

// UpdateRuleTypeRequest is the request to update a rule type.
message UpdateRuleTypeRequest {
    // rule_type is the rule type to be updated.
    RuleType rule_type = 2;
    reserved 3; // deprecated context
}

// UpdateRuleTypeResponse is the response to update a rule type.
message UpdateRuleTypeResponse {
    // rule_type is the rule type that was updated.
    RuleType rule_type = 1;
}

// DeleteRuleTypeRequest is the request to delete a rule type.
message DeleteRuleTypeRequest {
    // context is the context in which the rule type is evaluated.
    Context context = 1;
    // id is the id of the rule type to be deleted.
    string id = 2;
}

// DeleteRuleTypeResponse is the response to delete a rule type.
message DeleteRuleTypeResponse {
}

// --- END RuleType CRUD definitions

// --- START EvaluationResults definitions

message ListEvaluationResultsRequest{
    // context is the context in which the evaluation results are evaluated.
    Context context = 1;

    // profile is the profile name or ID to retrieve results for.
    // If empty, return evaluation results for profiles selected by
    // an empty label_filter.
    oneof profile_selector {
        // ID can contain either a profile name or an ID
        string profile = 2;
        // Filter profiles to only those matching the specified labels.
        // 
        // The default is to return all user-created profiles; the string "*" can
        // be used to select all profiles, including system profiles.  This syntax
        // may be expanded in the future.
        string label_filter = 3;
    }

    // If set, only return evaluation results for the named entities.
    // If empty, return evaluation results for all entities
    repeated EntityTypedId entity = 4;

    // If set, only return evaluation results for the named rules.
    // If empty, return evaluation results for all rules
    repeated string rule_name = 5;
}

message ListEvaluationResultsResponse {
    reserved 1; // deprecated status
    reserved "status";

    message EntityProfileEvaluationResults {
        // profile_status is the status of the profile - id, name, status, last_updated
        ProfileStatus profile_status = 1;

        // Note that some fields like profile_id and entity might be empty
        // Eventually we might replace this type with another one that fits the API better
        repeated RuleEvaluationStatus results = 2;
    }

    message EntityEvaluationResults {
        EntityTypedId entity = 1;
        repeated EntityProfileEvaluationResults profiles = 2;
    }

    // Each entity selected by the list request will have _single_ entry in entities which contains results of all evaluations for each profile.
    repeated EntityEvaluationResults entities = 2;
}

// --- END EvaluationResults definitions



// RestType defines the rest data evaluation.
// This is used to fetch data from a REST endpoint.
message RestType {
    message Fallback {
        int32 http_code = 1;
        string body = 2;
    }

    // endpoint is the endpoint to fetch data from.
    // This can be a URL or the path on the API.bool
    // This is a required field and must be set.
    // This is also evaluated via a template which allows
    // us dynamically fill in the values.
    string endpoint = 1;

    // method is the method to use to fetch data.
    string method = 2;

    // headers are the headers to be sent to the endpoint.
    repeated string headers = 3;

    // body is the body to be sent to the endpoint.
    optional string body = 4;

    // parse is the parsing mechanism to be used to parse the data.
    string parse = 5;

    // fallback provides a body that the ingester would return in case
    // the REST call returns a non-200 status code.
    repeated Fallback fallback = 6;
}

// BuiltinType defines the builtin data evaluation.
message BuiltinType {
    string method = 1;
}

// ArtifactType defines the artifact data evaluation.
message ArtifactType {
}

// GitType defines the git data ingester.
message GitType {
    // clone_url is the url of the git repository.
    string clone_url = 1;

    // branch is the branch of the git repository.
    string branch = 2;
}

// DiffType defines the diff data ingester.
message DiffType {
    message Ecosystem {
        // name is the name of the ecosystem.
        string name = 1;
        // depfile is the file that contains the dependencies for this ecosystem
        string depfile = 2;
    }

    // ecosystems is the list of ecosystems to be used
    // for the "dep" diff type.
    repeated Ecosystem ecosystems = 1;

    // type is the type of diff ingestor to use.
    // The default is "dep" which will leverage
    // the ecosystems array.
    string type = 2;
}

// Severity defines the severity of the rule.
message Severity {
    // Value enumerates the severity values.
    enum Value {
        VALUE_UNSPECIFIED = 0;
        // unknown severity means that the severity is unknown or hasn't
        // been set.
        VALUE_UNKNOWN = 1 [(name) = "unknown"];
        // info severity means that the severity is informational and
        // does not incur risk.
        VALUE_INFO = 2 [(name) = "info"];
        // low severity means that the severity is low and does not
        // incur significant risk.
        VALUE_LOW = 3 [(name) = "low"];
        // medium severity means that the severity is medium and may
        // incur some risk.
        VALUE_MEDIUM = 4 [(name) = "medium"];
        // high severity means that the severity is high and may incur
        // significant risk.
        VALUE_HIGH = 5 [(name) = "high"];
        // critical severity means that the severity is critical and
        // requires immediate attention.
        VALUE_CRITICAL = 6 [(name) = "critical"];
    }

    // value is the severity value.
    Value value = 1;
}

// RuleType defines rules that may or may not be user defined.
// The version is assumed from the folder's version.
message RuleType {
    // id is the id of the rule type.
    // This is mostly optional and is set by the server.
    optional string id = 1;

    // name is the name of the rule type.
    string name = 2;

    // display_name is the display name of the rule type.
    string display_name = 8;

    // context is the context in which the rule is evaluated.
    Context context = 3;

    // Definition defines the rule type. It encompases the schema and the data evaluation.
    message Definition {
        // in_entity is the entity in which the rule is evaluated.
        // This can be repository, build_environment or artifact.
        string in_entity = 1;

        // rule_schema is the schema of the rule. This is expressed in JSON Schema.
        google.protobuf.Struct rule_schema = 2;

        // param_schema is the schema of the parameters that are passed to the rule.
        // This is expressed in JSON Schema.
        optional google.protobuf.Struct param_schema = 3;

        // Ingest defines how the data is ingested.
        message Ingest {
            // type is the type of the data ingestion.
            // we currently support rest, artifact and builtin.
            string type = 1;

            // rest is the rest data ingestion.
            // this is only used if the type is rest.
            optional RestType rest = 3;

            // builtin is the builtin data ingestion.
            optional BuiltinType builtin = 4;

            // artifact is the artifact data ingestion.
            optional ArtifactType artifact = 5;

            // git is the git data ingestion.
            optional GitType git = 6;

            // diff is the diff data ingestion.
            optional DiffType diff = 7;
        }
        Ingest ingest = 4;

        // Eval defines the data evaluation definition.
        // This pertains to the way we traverse data from the upstream
        // endpoint and how we compare it to the rule.
        message Eval {
            // type is the type of the data evaluation.
            // Right now only `jq` is supported as a driver
            string type = 1;

            message JQComparison {
                message Operator {
                    string def = 1;
                }

                // Ingested points to the data retrieved in the `ingest` section
                Operator ingested = 1;

                // Profile points to the profile itself.
                Operator profile = 2;
            }

            message Rego {
                // type is the type of evaluation engine to use
                // for rego. We currently have two modes of operation:
                // - deny-by-default: this is the default mode of operation
                //   where we deny access by default and allow access only
                //   if the profile explicitly allows it. It expects the
                //   profile to set an `allow` variable to true or false.
                // - constraints: this is the mode of operation where we
                //   allow access by default and deny access only if a
                //   violation is found. It expects the profile to set a
                //   `violations` variable with a "msg" field.
                string type = 1;
                // def is the definition of the rego profile.
                string def = 2;
                // how are violations reported. This is only used if the
                // `constraints` type is selected. The default is `text`
                // which returns human-readable text. The other option is
                // `json` which returns a JSON array containing the violations.
                optional string violation_format = 3;
            }

            message Vulncheck {
                // no configuration for now
            }

            message Trusty {
                // This is no longer used, but is still here for backwards
                // compatibility with existing stored rules
                string endpoint = 1;
            }

            message Homoglyphs {
                string type = 1;
            }

            // jq is only used if the `jq` type is selected.
            // It defines the comparisons that are made between
            // the ingested data and the profile rule.
            repeated JQComparison jq = 2;

            // rego is only used if the `rego` type is selected.
            optional Rego rego = 3;

            // vulncheck is only used if the `vulncheck` type is selected.
            optional Vulncheck vulncheck = 4;

            // The trusty type is no longer used, but is still here for backwards
            // compatibility with existing stored rules
            optional Trusty trusty = 5;

            // homoglyphs is only used if the `homoglyphs` type is selected.
            optional Homoglyphs homoglyphs = 6;
        }
        Eval eval = 5;

        message Remediate {
            string type = 1;

            message GhBranchProtectionType {
                string patch = 1;
            }

            // the name stutters a bit but we already use a PullRequest message for handling PR entities
            message PullRequestRemediation {
                message Content {
                    // the file to patch
                    string path = 1;
                    // how to patch the file. For now, only replace is supported
                    string action = 2;
                    // the content of the file
                    string content = 4;
                    // the GIT mode of the file. Not UNIX mode! String because the GH API also uses strings
                    // the usual modes are: 100644 for regular files, 100755 for executable files and
                    // 040000 for submodules (which we don't use but now you know the meaning of the 1 in 100644)
                    // see e.g. https://github.com/go-git/go-git/blob/32e0172851c35ae2fac495069c923330040903d2/plumbing/filemode/filemode.go#L16
                    optional string mode = 3;
                }

                message ActionsReplaceTagsWithSha {
                    // List of actions to exclude from the replacement
                    repeated string exclude = 1;
                }

                // the title of the PR
                string title = 1;
                // the body of the PR
                string body = 2;
                repeated Content contents = 3;
                // the method to use to create the PR. For now, these are supported:
                // -- minder.content - ensures that the content of the file is exactly as specified
                //                     refer to the Content message for more details
                // -- minder.actions.replace_tags_with_sha - finds any github actions within a workflow
                //                                           file and replaces the tag with the SHA
                string method = 4;

                // If the method is minder.actions.replace_tags_with_sha, this is the configuration
                // for that method
                optional ActionsReplaceTagsWithSha actions_replace_tags_with_sha = 5;
            }

            optional RestType rest = 2;
            optional GhBranchProtectionType gh_branch_protection = 3;
            optional PullRequestRemediation pull_request = 4;
        }
        Remediate remediate = 6;

        message Alert {
            string type = 1;

            message AlertTypeSA {
                string severity = 1;
            }
            optional AlertTypeSA security_advisory = 2;
        }
        Alert alert = 7;
    }

    // def is the definition of the rule type.
    Definition def = 4;

    // description is the description of the rule type.
    string description = 5;

    // guidance are instructions we give the user in case a rule fails.
    string guidance = 6;

    // severity is the severity of the rule type.
    Severity severity = 7;
}

// Profile defines a profile that is user defined.
message Profile {
    // context is the context in which the profile is evaluated.
    Context context = 1;

    // id is the id of the profile.
    // This is optional and is set by the system.
    optional string id = 2;

    // name is the name of the profile instance.
    string name = 3;

    // labels are a set of system-provided attributes which can be used to
    // filter profiles and status results.  Labels cannot be set by the user,
    // but are returned in ListProfiles.
    //
    // Labels use DNS label constraints, with a possible namespace prefix
    // separated by a colon (:).  They are intended to allow filtering, but
    // not to store arbitrary metadata.
    // DNS labels are 1-63 character alphanumeric strings with internal hyphens.
    // An RE2-style validation regex would be:
    //
    // DNS_STR = "[a-zA-Z0-9](?[-a-zA-Z0-9]{0,61}[a-zA-Z0-9])?"
    // ($DNS_STR:)?$DNS_STR
    repeated string labels = 12;

    // Rule defines the individual call of a certain rule type.
    message Rule {
        // type is the type of the rule to be instantiated.
        string type = 1;
        // params are the parameters that are passed to the rule.
        // This is optional and depends on the rule type.
        google.protobuf.Struct params = 2;
        // def is the definition of the rule.
        // This depends on the rule type.
        google.protobuf.Struct def = 3;

        // name is the descriptive name of the rule, not to be confused with type
        string name = 4;
    }

    // These are the entities that one could set in the profile.
    repeated Rule repository = 4;
    repeated Rule build_environment = 5;
    repeated Rule artifact = 6;
    repeated Rule pull_request = 7;
    repeated Rule release = 15;
    repeated Rule pipeline_run = 16;
    repeated Rule task_run = 17;
    repeated Rule build = 18;

    message Selector {
        // id is optional and use for updates to match upserts as well as read operations. It is ignored for creates.
        string id = 1;
        // entity is the entity to select.
        string entity = 2;
        // expr is the expression to select the entity.
        string selector = 4;
        reserved 5;
        reserved "comment";
        // description is the human-readable description of the selector.
        string description = 6;
    }

    repeated Selector selection = 14;

    // whether and how to remediate (on,off,dry_run)
    // this is optional and defaults to "off"
    optional string remediate = 8;

    // whether and how to alert (on,off,dry_run)
    // this is optional and defaults to "on"
    optional string alert = 9;

    // type is a placeholder for the object type. It should always be set to "profile".
    string type = 10;

    // version is the version of the profile type. In this case, it is "v1"
    string version = 11;

    // display_name is the display name of the profile.
    string display_name = 13;
}

message ListProjectsRequest {

}

message ListProjectsResponse {
    repeated Project projects = 1;
}

message CreateProjectRequest {
    // context is the context in which the project is created.
    Context context = 1;

    // name is the name of the project to create.
    string name = 2;
}

message CreateProjectResponse {
    // project is the project that was created.
    Project project = 1;
}

message DeleteProjectRequest {
    // context is the context in which the project is deleted.
    Context context = 1;
}

message DeleteProjectResponse {
    // project_id is the id of the project that was deleted.
    string project_id = 1;
}

message UpdateProjectRequest {
    // context is the context in which the project is updated.
    Context context = 1;

    // display_name is the display name of the project to update.
    string display_name = 2;

    // description is the description of the project to update.
    string description = 3;
}

message UpdateProjectResponse {
    // project is the project that was updated.
    Project project = 1;
}

message ProjectPatch {
    // display_name is the display name of the project to update.
    optional string display_name = 1;

    // description is the description of the project to update.
    optional string description = 2;
}

message PatchProjectRequest {
    // context is the context in which the project is updated.
    Context context = 1;

    // patch is the patch to apply to the project
    ProjectPatch patch = 3;

    // needed to enable PATCH, see https://grpc-ecosystem.github.io/grpc-gateway/docs/mapping/patch_feature/
    // is not exposed to the API user
    google.protobuf.FieldMask update_mask = 4;
}

message PatchProjectResponse {
    // project is the project that was updated.
    Project project = 1;
}

message ListChildProjectsRequest {
    // context is the context in which the child projects are listed.
    ContextV2 context = 1;

    // recursive is true if child projects should be listed recursively.
    bool recursive = 2;
}

message ListChildProjectsResponse {
    repeated Project projects = 1;
}

message CreateEntityReconciliationTaskRequest {
    // entity is the entity to be reconciled.
    EntityTypedId entity = 1;

    // context is the context in which the entity reconciliation task is created.
    Context context = 2;
}

message CreateEntityReconciliationTaskResponse {
}

message ListRolesRequest {
    // context is the context in which the roles are evaluated.
    Context context = 1;
}

message ListRolesResponse {
    repeated Role roles = 1;
}

message ListRoleAssignmentsRequest {
    // context is the context in which the role assignments are evaluated.
    Context context = 1;
}

message ListRoleAssignmentsResponse {
    // role_assignments contains permission grants which have been accepted
    // by a user.
    repeated RoleAssignment role_assignments = 1;

    // invitations contains outstanding role invitations which have not yet
    // been accepted by a user.
    repeated Invitation invitations = 2;
}

message AssignRoleRequest {
    // context is the context in which the role assignment is evaluated.
    Context context = 1;
    // role_assignment is the role assignment to be created.
    RoleAssignment role_assignment = 2;
}

message AssignRoleResponse {
    // role_assignment is the role assignment that was created.
    RoleAssignment role_assignment = 1;

    // invitation contains the details of the invitation for the
    // assigned user to join the project if the user is not already
    // a member.
    Invitation invitation = 2;
}

message UpdateRoleRequest {
    // context is the context in which the role assignment is evaluated.
    Context context = 1;
    // subject is the account to change permissions for.
    // The account must already have permissions on the project
    string subject = 2;
    // All subject roles are _replaced_ with the following role assignments.  Must be non-empty,
    // use RemoveRole to remove permissions entirely from the project.
    repeated string roles = 4;
    // email is the email address of the subject used for updating invitations
    string email = 5;

    reserved 3; // deprecated repeated string role = 3;
    reserved "role";
}

message UpdateRoleResponse {
    // role_assignments are the role assignments that were updated.
    repeated RoleAssignment role_assignments = 1;
    // invitations contains the details of the invitations that were updated.
    repeated Invitation invitations = 2;
}


message RemoveRoleRequest {
    // context is the context in which the role assignment is evaluated.
    Context context = 1;
    // role_assignment is the role assignment to be removed.
    RoleAssignment role_assignment = 2;
}

message RemoveRoleResponse {
    // role_assignment is the role assignment that was removed.
    RoleAssignment role_assignment = 1;
    // invitation contains the details of the invitation that was removed.
    Invitation invitation = 2;
}

message Role {
    // name is the name of the role.
    string name = 1;
    // display name of the role
    string display_name = 3;
    // description is the description of the role.
    string description = 2;
}

message RoleAssignment {
    // role is the role that is assigned.
    string role = 1;
    // subject is the subject to which the role is assigned.
    string subject = 2;
    // display_name is the display name of the subject.
    string display_name = 5;
    // project is the project in which the role is assigned.
    optional string project = 4;
    // email is the email address of the subject used for invitations.
    string email = 6;
    // first_name is the first name of the subject.
    string first_name = 7;
    // last_name is the last name of the subject.
    string last_name = 8;

    reserved 3; // deprecated context
}

message ListInvitationsRequest {
}

message ListInvitationsResponse {
    repeated Invitation invitations = 1;
}

message ResolveInvitationRequest {
    // code is the code of the invitation to resolve.
    string code = 1;
    // accept is true if the invitation is accepted, false if it is rejected.
    bool accept = 2;
}

message ResolveInvitationResponse {
    // role is the role that would be assigned if the user
    // accepts the invitation.
    string role = 1;
    // email is the email address of the invited user.
    string email = 2;
    // project is the project to which the user is invited.
    string project = 3;
    // is_accepted is the status of the invitation.
    bool is_accepted = 4;
    // project_display is the display name of the project to which the user
    // is invited.
    string project_display = 5;
}

message Invitation {
    // role is the role that would be assigned if the user
    // accepts the invitation.
    string role = 1;
    // email is the email address of the invited user.  This is
    // presented as a convenience for display purposes, and does
    // not affect who can accept the invitation using the code.
    string email = 2;
    // project is the project to which the user is invited.
    string project = 3;

    // code is a unique identifier for the invitation, which can
    // be used by the recipient to accept or reject the invitation.
    // The code is only transmitted in response to AssignRole or
    // ListInvitations RPCs, and not transmitted in
    // ListRoleAssignments or other calls.
    string code = 4;

    // created_at is the time at which the invitation was created.
    google.protobuf.Timestamp created_at = 5;
    // expires_at is the time at which the invitation expires.
    google.protobuf.Timestamp expires_at = 6;
    // expired is true if the invitation has expired.
    bool expired = 9;

    // sponsor is the account (ID) of the user who created the invitation.
    string sponsor = 7;
    // sponsor_display is the display name of the user who created the
    // invitation.
    string sponsor_display = 8;
    // project_display is the display name of the project to which the user
    // is invited.
    string project_display = 10;
    // inviteURL is the URL that can be used to accept the invitation.
    string invite_url = 11;
    // emailSkipped is true if the email was not sent to the invitee.
    bool email_skipped = 12;
}

message GetProviderRequest {
    // context is the context in which the provider is evaluated.
    Context context = 1;
    // name is the name of the provider to get.
    string name = 2;
}

message GetProviderResponse {
    // provider is the provider that was retrieved.
    Provider provider = 1;
}

message ListProvidersRequest {
    // context is the context in which the providers are evaluated.
    Context context = 1;

    // limit is the maximum number of providers to return.
    int32 limit = 2;

    // cursor is the cursor to use for the page of results, empty if at the beginning
    string cursor = 3;
}

message ListProvidersResponse {
    repeated Provider providers = 1;

    // cursor is the cursor to use for the next page of results, empty if at the end
    string cursor = 2;
}

message CreateProviderRequest {
    // context is the context in which the provider is created.
    Context context = 1;
    // provider is the provider to be created.
    Provider provider = 2;
}

message CreateProviderResponse {
    // provider is the provider that was created.
    Provider provider = 1;

    // authorization provides additional authorization information needed
    // to complete the initialization of the provider.
    AuthorizationParams authorization = 2;
}

message DeleteProviderRequest {
    // context is the context in which the provider is deleted.  Both
    // project and provider are required in this context.
    Context context = 1;
}

message DeleteProviderResponse {
    // name is the name of the provider that was deleted
    string name = 1;
}

message DeleteProviderByIDRequest {
    // context is the context in which the provider is deleted. Only the project is required in this context.
    Context context = 1;
    // id is the id of the provider to delete
    string id = 2;
}

message DeleteProviderByIDResponse {
    // id is the id of the provider that was deleted
    string id = 1;
}

message GetUnclaimedProvidersRequest {
    // context is the context in which the set of providers are evaluated.
    Context context = 1;
}

message GetUnclaimedProvidersResponse {
    // providers is a set of parameters which can be supplied to allow the user
    // to assign existing unclaimed credentials to a new provider in the project
    // via CreateProvider().
    repeated ProviderParameter providers = 1;
}

message ListProviderClassesRequest {
    // context is the context in which the provider classes are evaluated.
    Context context = 1;
}

message ListProviderClassesResponse {
    // provider_classes is the list of provider classes.
    repeated string provider_classes = 1;
}

message PatchProviderRequest {
    Context context = 1;
    Provider patch = 2;

    google.protobuf.FieldMask update_mask = 3;
}

message PatchProviderResponse {
    Provider provider = 1;
}

message AuthorizationParams {
    // authorization_url is an external URL to use to authorize the provider.
    string authorization_url = 1;

}

message ProviderParameter {
    oneof parameters {
        GitHubAppParams github_app = 1;
    }
}

// GitHubAppParams is the parameters for a GitHub App provider.
message GitHubAppParams {
    // The GitHub installation ID for the app.  On create, this is the only
    // parameter used; the organization parameters are ignored.
    int64 installation_id = 1;

    // The GitHub organization slug where the app is installed.  This is an
    // output-only parameter, and is validated on input if set (i.e. the value
    // must be either empty or match the org of the installation_id).
    string organization = 2;
    // The GitHub organization ID where the app is installed.  This is an
    // output-only parameter, and is validated on input if set (i.e. the value
    // must be either empty or match the org of the installation_id).
    int64 organization_id = 3;
}

// ProviderTrait is the type of the provider.
enum ProviderType {
    PROVIDER_TYPE_UNSPECIFIED = 0;
    PROVIDER_TYPE_GITHUB = 1 [(name) = "github"];
    PROVIDER_TYPE_REST = 2 [(name) = "rest"];
    PROVIDER_TYPE_GIT = 3 [(name) = "git"];
    PROVIDER_TYPE_OCI = 4 [(name) = "oci"];
    PROVIDER_TYPE_REPO_LISTER = 5 [(name) = "repo-lister"];
    PROVIDER_TYPE_IMAGE_LISTER = 6 [(name) = "image-lister"];
}

enum ProviderClass {
    PROVIDER_CLASS_UNSPECIFIED = 0;
    PROVIDER_CLASS_GITHUB = 1 [(name) = "github"];
    PROVIDER_CLASS_GITHUB_APP = 2 [(name) = "github-app"];
    PROVIDER_CLASS_GHCR = 3 [(name) = "ghcr"];
    PROVIDER_CLASS_DOCKERHUB = 4 [(name) = "dockerhub"];
}

enum AuthorizationFlow {
    AUTHORIZATION_FLOW_UNSPECIFIED = 0;
    AUTHORIZATION_FLOW_NONE = 1 [(name) = "none"];
    AUTHORIZATION_FLOW_USER_INPUT = 2 [(name) = "user_input"];
    AUTHORIZATION_FLOW_OAUTH2_AUTHORIZATION_CODE_FLOW = 3 [(name) = "oauth2_authorization_code_flow"];
    AUTHORIZATION_FLOW_GITHUB_APP_FLOW = 4 [(name) = "github_app_flow"];
}

enum CredentialsState {
    CREDENTIALS_STATE_UNSPECIFIED = 0;
    CREDENTIALS_STATE_SET = 1 [(name) = "set"];
    CREDENTIALS_STATE_UNSET = 2 [(name) = "unset"];
    CREDENTIALS_STATE_NOT_APPLICABLE = 3 [(name) = "not_applicable"];
}

message Provider {
    // name is the name of the provider.
    string name = 1;
    // class is the name of the provider implementation, eg. 'github' or 'gh-app'.
    string class = 7;
    // project is the project where the provider is.  This is ignored on input
    // in favor of the context field in CreateProviderRequest.
    string project = 2;
    // version is the version of the provider.
    string version = 3;

    // implements is the list of interfaces that the provider implements.
    repeated ProviderType implements = 4;

    // config is the configuration of the provider.
    google.protobuf.Struct config = 5;

    // auth_flows is the list of authorization flows that the provider supports.
    repeated AuthorizationFlow auth_flows = 6;

    // parameters is the list of parameters that the provider requires.
    ProviderParameter parameters = 8;

    // credentials_state is the state of the credentials for the provider.
    // This is an output-only field. It may be: "set", "unset", "not_applicable".
    string credentials_state = 9;
}

// ListEvaluationHistoryRequest represents a request message for the
// ListEvaluationHistory RPC.
//
// Most of its fields are used for filtering, except for `cursor`
// which is used for pagination.
message ListEvaluationHistoryRequest {
    Context context = 1;

    // List of entity types to retrieve.
    repeated string entity_type = 2;
    // List of entity names to retrieve.
    repeated string entity_name = 3;
    // List of profile names to retrieve.
    repeated string profile_name = 4;
    // List of evaluation statuses to retrieve.
    repeated string status = 5;
    // List of remediation statuses to retrieve.
    repeated string remediation = 6;
    // List of alert statuses to retrieve.
    repeated string alert = 7;
    // Timestamp representing the start time of the selection window.
    google.protobuf.Timestamp from = 8;
    // Timestamp representing the end time of the selection window.
    google.protobuf.Timestamp to = 9;

    // Cursor object to select the "page" of data to retrieve.
    Cursor cursor = 10;
}

// ListEvaluationHistoryResponse represents a response message for the
// ListEvaluationHistory RPC.
//
// It ships a collection of records retrieved and pointers to get to
// the next and/or previous pages of data.
message ListEvaluationHistoryResponse {
    // List of records retrieved.
    repeated EvaluationHistory data = 1;
    // Metadata of the current page and pointers to next and/or
    // previous pages.
    CursorPage page = 2;
}

message EvaluationHistory {
    // entity contains details of the entity which was evaluated.
    EvaluationHistoryEntity entity = 1;

    // rule contains details of the rule which the entity was evaluated against.
    EvaluationHistoryRule rule = 2;

    // status contains the evaluation status.
    EvaluationHistoryStatus status = 3;

    // alert contains details of the alerts for this evaluation.
    EvaluationHistoryAlert alert = 4;

    // remediation contains details of the remediation for this evaluation.
    EvaluationHistoryRemediation remediation = 5;

    // created_at is the timestamp of creation of this evaluation
    google.protobuf.Timestamp evaluated_at = 6;
}

message EvaluationHistoryEntity {
    // id is the unique identifier of the entity.
    string id = 1;

    // type is the entity type.
    Entity type = 2;

    // name is the entity name.
    string name = 3;
}

message EvaluationHistoryRule {
    // name is the name of the rule instance.
    string name = 1;

    // type is the name of the rule type.
    string rule_type = 2;

    // profile is the name of the profile which contains the rule.
    string profile = 3;
}

message EvaluationHistoryStatus {
    // status is one of (success, error, failure, skipped)
    // not using enums to mirror the behaviour of the existing API contracts.
    string status = 1;

    // details contains optional details about the evaluation.
    // the structure and contents are rule type specific, and are subject to change.
    string details = 2;
}

message EvaluationHistoryRemediation {
    // status is one of (success, error, failure, skipped, not available)
    // not using enums to mirror the behaviour of the existing API contracts.
    string status = 1;

    // details contains optional details about the remediation.
    // the structure and contents are remediation specific, and are subject to change.
    string details = 2;
}

message EvaluationHistoryAlert {
    // status is one of (on, off, error, skipped, not available)
    // not using enums to mirror the behaviour of the existing API contracts.
    string status = 1;

    // details contains optional details about the alert.
    // the structure and contents are alert specific, and are subject to change.
    string details = 2;
}
