"use strict";(self.webpackChunkminder_docs=self.webpackChunkminder_docs||[]).push([[9332],{92714:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"run_minder_server/config_provider","title":"Configure a provider","description":"A provider connects Minder to your software supply chain \u2014 giving Minder","source":"@site/docs/run_minder_server/config_provider.md","sourceDirName":"run_minder_server","slug":"/run_minder_server/config_provider","permalink":"/run_minder_server/config_provider","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":50,"frontMatter":{"title":"Configure a provider","sidebar_position":50},"sidebar":"minder","previous":{"title":"Installing a production version","permalink":"/run_minder_server/installing_minder"},"next":{"title":"Configuring a webhook","permalink":"/run_minder_server/config_webhook"}}');var t=i(74848),s=i(28453);const d={title:"Configure a provider",sidebar_position:50},a=void 0,o={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create a GitHub App",id:"create-a-github-app",level:2},{value:"Basic information",id:"basic-information",level:3},{value:"Identifying and authorizing users",id:"identifying-and-authorizing-users",level:3},{value:"Webhook",id:"webhook",level:3},{value:"Permissions",id:"permissions",level:3},{value:"Installation and scope",id:"installation-and-scope",level:3},{value:"Generate a client secret",id:"generate-a-client-secret",level:3},{value:"Generate a private key",id:"generate-a-private-key",level:3},{value:"Configure the Minder server",id:"configure-the-minder-server",level:2},{value:"Add GitHub App configuration",id:"add-github-app-configuration",level:3},{value:"Add provider configuration",id:"add-provider-configuration",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"A provider connects Minder to your software supply chain \u2014 giving Minder\ninformation about your source code repositories, and their pull requests,\ndependencies, and artifacts."}),"\n",(0,t.jsx)(n.p,{children:"The currently supported providers are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"GitHub"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For GitHub, you configure a provider by creating a GitHub App."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com",children:"GitHub"})," account"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"create-a-github-app",children:"Create a GitHub App"}),"\n",(0,t.jsx)(n.p,{children:"This approach allows fine-grained control over the permissions that Minder has\nin users' repositories. It also allows users to limit the repositories that\nMinder can access."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Navigate to ",(0,t.jsx)(n.a,{href:"https://github.com/settings/profile",children:"GitHub Developer Settings"})]}),"\n",(0,t.jsx)(n.li,{children:'Select "Developer Settings" from the left hand menu'}),"\n",(0,t.jsx)(n.li,{children:'Select "GitHub Apps" from the left hand menu'}),"\n",(0,t.jsx)(n.li,{children:'Select "New GitHub App"'}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Adding a new GitHub App",src:i(4007).A+"",width:"2518",height:"750"})}),"\n",(0,t.jsx)(n.h3,{id:"basic-information",children:"Basic information"}),"\n",(0,t.jsx)(n.p,{children:"Complete the following fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["GitHub App Name: ",(0,t.jsx)(n.code,{children:"My Minder App"})," (or any other name you like)"]}),"\n",(0,t.jsxs)(n.li,{children:["Homepage URL: ",(0,t.jsx)(n.code,{children:"http://localhost:8080"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Basic fields",src:i(76045).A+"",width:"1522",height:"1000"})}),"\n",(0,t.jsx)(n.h3,{id:"identifying-and-authorizing-users",children:"Identifying and authorizing users"}),"\n",(0,t.jsx)(n.p,{children:"Complete the following fields:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Callback URL: ",(0,t.jsx)(n.code,{children:"http://localhost:8080/api/v1/auth/callback/github-app/app"})]}),"\n",(0,t.jsxs)(n.li,{children:["Add an additional callback URL for Keycloak:\n",(0,t.jsx)(n.code,{children:"http://localhost:8081/realms/stacklok/broker/github/endpoint"})]}),"\n",(0,t.jsx)(n.li,{children:'Select the checkbox for "Request user authorization (OAuth) during\ninstallation"'}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Configuring the GitHub provider",src:i(9894).A+"",width:"1588",height:"948"})}),"\n",(0,t.jsx)(n.h3,{id:"webhook",children:"Webhook"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Under Webhook, uncheck Active"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"permissions",children:"Permissions"}),"\n",(0,t.jsx)(n.p,{children:"Select the following permissions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Repository Permissions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Administration (read and write)"}),"\n",(0,t.jsx)(n.li,{children:"Contents (read and write)"}),"\n",(0,t.jsx)(n.li,{children:"Metadata (read only)"}),"\n",(0,t.jsx)(n.li,{children:"Packages (read and write)"}),"\n",(0,t.jsx)(n.li,{children:"Pull requests (read and write)"}),"\n",(0,t.jsx)(n.li,{children:"Repository security advisories (read and write)"}),"\n",(0,t.jsx)(n.li,{children:"Webhooks (read and write)"}),"\n",(0,t.jsx)(n.li,{children:"Workflows (read and write)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Account permissions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Email addresses (read only)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Once completed, double check your selected numbers match the ones in the\nscreenshot."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Permissions",src:i(77755).A+"",width:"737",height:"502"})}),"\n",(0,t.jsx)(n.h3,{id:"installation-and-scope",children:"Installation and scope"}),"\n",(0,t.jsx)(n.p,{children:'For the option "Where can this GitHub App be installed?":'}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Select "Any account" if you want to allow any GitHub user to install the app'}),"\n",(0,t.jsx)(n.li,{children:'Or, select "Only on this account" to restrict the app to only your account.'}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:'Then select "Create GitHub App" to create the App.'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Permissions",src:i(13939).A+"",width:"1654",height:"376"})}),"\n",(0,t.jsx)(n.h3,{id:"generate-a-client-secret",children:"Generate a client secret"}),"\n",(0,t.jsxs)(n.p,{children:["You should now have a GitHub App created. You now need to create a\n",(0,t.jsx)(n.code,{children:"Client secret"})," for authentication. Click the\n",(0,t.jsx)(n.code,{children:"Generate a new client secret button"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Client secret",src:i(76666).A+"",width:"1542",height:"552"})}),"\n",(0,t.jsx)(n.p,{children:"Save the Client secret value for use in the Configure Minder step."}),"\n",(0,t.jsx)(n.h3,{id:"generate-a-private-key",children:"Generate a private key"}),"\n",(0,t.jsx)(n.p,{children:"Scroll down to the bottom of the page and generate a private key."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Generate a private key",src:i(2336).A+"",width:"1536",height:"624"})}),"\n",(0,t.jsxs)(n.p,{children:["This will generate and download your private key. Now we need to move and rename\nthe private key. Run the following commands from the Minder root directory,\nreplacing ",(0,t.jsx)(n.code,{children:"<downloaded-file>"})," with the path to the downloaded private key."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir .secrets\ncp <downloaded-file> .secrets/github-app.pem\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configure-the-minder-server",children:"Configure the Minder server"}),"\n",(0,t.jsx)(n.p,{children:"Now that we've created our GitHub App, we need to configure the Minder server to\nuse it."}),"\n",(0,t.jsx)(n.h3,{id:"add-github-app-configuration",children:"Add GitHub App configuration"}),"\n",(0,t.jsxs)(n.p,{children:["In your ",(0,t.jsx)(n.code,{children:"server-config.yaml"})," file, located in the root Minder directory, find\nthe following section:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"github-app:\n  client_id: 'client-id'\n  client_secret: 'client-secret'\n  redirect_uri: 'http://localhost:8080/api/v1/auth/callback/github-app/app' # This needs to match the registered callback URL in the GitHub App\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Update the ",(0,t.jsx)(n.code,{children:"client_id"})," and ",(0,t.jsx)(n.code,{children:"client_secret"})," values with the following:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Client ID : Found in the General -> About section of your GitHub App on\nGitHub."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Client ID",src:i(51454).A+"",width:"1992",height:"570"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Client Secret : The value you saved previously."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"add-provider-configuration",children:"Add provider configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Then, find the following section in the same ",(0,t.jsx)(n.code,{children:"server-config.yaml"})," file:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"provider:\n  github-app:\n    app_name: 'app-name'\n    app_id: 1234\n    user_id: 1234\n    private_key: '.secrets/github-app.pem'\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Update the ",(0,t.jsx)(n.code,{children:"app_name"})," with the name of your app, which you can get by looking at\nthe GitHub URL when editing your GitHub App. For example, if the URL is\n",(0,t.jsx)(n.a,{href:"https://github.com/settings/apps/my-test-app",children:"https://github.com/settings/apps/my-test-app"}),", then your app name is my-test-app."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"App name",src:i(30324).A+"",width:"1192",height:"290"})}),"\n",(0,t.jsxs)(n.p,{children:["Update ",(0,t.jsx)(n.code,{children:"app_id"})," with the app ID of your GitHub App, which is found in the\nGeneral -> About section of your GitHub App on GitHub."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"App ID",src:i(33154).A+"",width:"2012",height:"598"})}),"\n",(0,t.jsxs)(n.p,{children:["Finally, you need the ",(0,t.jsx)(n.code,{children:"user_id"})," value. To get the value, run the following\ncommand, where ",(0,t.jsx)(n.code,{children:"<app-name>"})," is the App name you used above:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl https://api.github.com/users/<app-name>%5Bbot%5D\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Update the ",(0,t.jsx)(n.code,{children:"user_id"})," value with the ",(0,t.jsx)(n.code,{children:"id"})," value returned from that command."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"User ID",src:i(79770).A+"",width:"1382",height:"396"})}),"\n",(0,t.jsx)(n.p,{children:"Now save the file. Your provider is now created and the Minder server is\nconfigured to use it."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},4007:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/new-github-app-8f9f342c6d6f6b33b4852b53f8f8f618.png"},33154:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-app-id-c6d0dce03720088ff5e82986c43eefad.png"},30324:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-app-name-d1ba3f2a816a5b8abb782dbdf8f8a692.png"},76045:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-basic-d2efd7a139d4879afb63ab8a7174bf2d.png"},51454:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-client-id-452c0664de27786de183499d667a1893.png"},76666:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-client-secret-created-0b6b69e9a90967c375eca2f4ca34db1e.png"},13939:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-create-dafb91a095f850584d309b9122680cba.png"},2336:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-generate-private-43daf2bdd975fd6f81204e0b4a1d5877.png"},9894:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-ident-and-auth-f32c9f5eee15c757b8538811a4f08a50.png"},77755:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-permissions-5c74ac3b57bb9eb20af2eb53eb0e9fcc.png"},79770:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/provider-user-id-88716c32b50c5d87172f15d2115f6f00.png"},28453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>a});var r=i(96540);const t={},s=r.createContext(t);function d(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);