"use strict";(self.webpackChunkminder_docs=self.webpackChunkminder_docs||[]).push([[9230],{79279:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"understand/data_sources","title":"data_sources","description":"What Is a data source?","source":"@site/docs/understand/data_sources.md","sourceDirName":"understand","slug":"/understand/data_sources","permalink":"/understand/data_sources","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"minder","previous":{"title":"Automatic remediation","permalink":"/understand/remediations"},"next":{"title":"Creating a profile","permalink":"/how-to/create_profile"}}');var r=i(74848),s=i(28453);const a={},o=void 0,l={},c=[{value:"What Is a <em>data source</em>?",id:"what-is-a-data-source",level:3},{value:"Key Attributes",id:"key-attributes",level:4},{value:"Why Would You Use a <em>data source</em>?",id:"why-would-you-use-a-data-source",level:3},{value:"Defining a <em>data source</em>",id:"defining-a-data-source",level:3},{value:"Key Fields",id:"key-fields",level:4},{value:"Using a <em>data source</em> in a Rule",id:"using-a-data-source-in-a-rule",level:3},{value:"Rule Evaluation In Action",id:"rule-evaluation-in-action",level:4}];function d(e){const n={a:"a",code:"code",em:"em",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h3,{id:"what-is-a-data-source",children:["What Is a ",(0,r.jsx)(n.em,{children:"data source"}),"?"]}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.em,{children:"data source"})," in Minder is a component that enriches your existing entities with additional information. (For broader context, see ",(0,r.jsx)(n.a,{href:"https://mindersec.github.io/understand/key_concepts#data-sources",children:"Data Sources in Minder"}),".)"]}),"\n",(0,r.jsxs)(n.p,{children:["While providers in Minder typically create or manage entities (e.g., repositories, issues, PRs, or services) and handle their lifecycle (registration, webhooks, etc.), ",(0,r.jsx)(n.em,{children:"data sources"})," contribute extra context or data points about those already-created entities."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Providers"}),": Create and manage entities (e.g., ingest a GitHub repository)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Data sources"}),": Enrich or augment existing entities with external or supplementary data (e.g., fetch known vulnerabilities for a package)."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"key-attributes",children:"Key Attributes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["They do ",(0,r.jsx)(n.strong,{children:"not"})," create entities. Data sources only enhance an entity already known to Minder."]}),"\n",(0,r.jsx)(n.li,{children:"They can reference external services\u2014for instance, pulling in vulnerability data from OSV or ClearlyDefined or a malware scanning service."}),"\n",(0,r.jsx)(n.li,{children:"They have arguments that help shape the queries or requests the data source makes against external systems (e.g., specifying the package name, ecosystem, or version)."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"why-would-you-use-a-data-source",children:["Why Would You Use a ",(0,r.jsx)(n.em,{children:"data source"}),"?"]}),"\n",(0,r.jsx)(n.p,{children:"You would create a data source in Minder whenever you need additional information about an entity that was not included in the initial ingest. Common scenarios include:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Enriching dependencies"}),": If a provider ingests a list of dependencies from a repository, a data source can query a vulnerability database (like OSV or ClearlyDefined) to see if any are known to be risky ",(0,r.jsx)(n.em,{children:"from a security or licensing point of view"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performing security checks"}),": A data source might call out to a malware scanner or an external REST service to verify the integrity of binaries or tarballs."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fetching attestation data"}),": If you need statements of provenance or supply-chain attestations from a separate system, a data source can gather this data for your entity."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Aggregating metadata from multiple sources"}),": For instance, combining ClearlyDefined\u2019s scoring data with an internal database that tracks maintainers, deprecation status, or license data."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Essentially, data sources let Minder orchestrate external queries that feed into policy evaluations (e.g., Rego constraints) to create richer compliance, security, or operational checks."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"defining-a-data-source",children:["Defining a ",(0,r.jsx)(n.em,{children:"data source"})]}),"\n",(0,r.jsxs)(n.p,{children:["When you invoke a data source in a Rego policy, you typically provide a set of arguments. These arguments tell the data source ",(0,r.jsx)(n.em,{children:"what"})," to fetch or ",(0,r.jsx)(n.em,{children:"how"})," to fetch it."]}),"\n",(0,r.jsx)(n.p,{children:"For example, consider the YAML snippet below:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"version: v1\ntype: data-source\nname: ghapi\ncontext: {}\nrest:\n  def:\n    license:\n      endpoint: https://api.github.com/repos/{owner}/{repo}/license\n      parse: json\n      input_schema:\n        type: object\n        properties:\n          owner:\n            type: string\n          repo:\n            type: string\n    repo_config:\n      endpoint: https://api.github.com/repos/{owner}/{repo}\n      parse: json\n      input_schema:\n        type: object\n        properties:\n          owner:\n            type: string\n          repo:\n            type: string\n    private_vuln_reporting:\n      endpoint: https://api.github.com/repos/{owner}/{repo}/private-vulnerability-reporting\n      parse: json\n      input_schema:\n        type: object\n        properties:\n          owner:\n            type: string\n          repo:\n            type: string\n"})}),"\n",(0,r.jsx)(n.h4,{id:"key-fields",children:"Key Fields"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"version / type / name"}),": Defines this resource as a data source called ",(0,r.jsx)(n.code,{children:"ghapi"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"context"}),": Typically holds the project context. Here it\u2019s ",(0,r.jsx)(n.code,{children:"{}"}),", meaning it\u2019s globally available (or within your chosen project scope)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"rest"}),": Declares REST-based operations. Under ",(0,r.jsx)(n.code,{children:"def"}),", we define three endpoints:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"license"})," \u2192 Fetches repository license info from GitHub"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"repo_config"})," \u2192 Fetches general repo config (e.g., visibility, description, forks, watchers)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"private_vuln_reporting"})," \u2192 Fetches whether the repository has private vulnerability reporting enabled"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"endpoint"}),": A template URI with placeholders for ",(0,r.jsx)(n.code,{children:"{owner}"})," and ",(0,r.jsx)(n.code,{children:"{repo}"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"parse"}),": Indicates the response format (",(0,r.jsx)(n.code,{children:"json"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"input_schema"}),": Uses JSON Schema to define the parameters needed by this data source in Rego. If you specify ",(0,r.jsx)(n.code,{children:"input_schema"})," incorrectly, you will receive an error at runtime, helping ensure that the data you pass in matches what the data source expects.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.em,{children:"(Note: You can define additional properties as needed, but only fields explicitly handled by the data source code will be recognized.)"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h3,{id:"using-a-data-source-in-a-rule",children:["Using a ",(0,r.jsx)(n.em,{children:"data source"})," in a Rule"]}),"\n",(0,r.jsxs)(n.p,{children:["Below is the definition of a rule type named ",(0,r.jsx)(n.strong,{children:"osps-vm-05"}),". Notice how it includes ",(0,r.jsx)(n.code,{children:"ghapi"})," under ",(0,r.jsx)(n.code,{children:"data_sources"})," and calls ",(0,r.jsx)(n.code,{children:"ghapi.private_vuln_reporting"})," in the Rego policy. We need the data source here because the rule checks private vulnerability reporting\u2014information that isn\u2019t part of the standard entity data and must be fetched from GitHub\u2019s API."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'---\nversion: v1\nrelease_phase: alpha\ntype: rule-type\nname: osps-vm-05\ndisplay_name: Contacts and process for reporting vulnerabilities is published\nshort_failure_message: No contacts or process for reporting vulnerabilities was found\nseverity:\n  value: info\ncontext:\n  provider: github\ndescription: |\n  This rule ensures that the repository provides a clear process and contact information \n  for reporting vulnerabilities. \n  It checks for the presence of a SECURITY.md file containing relevant reporting \n  details or verifies if GitHub\'s private vulnerability reporting feature is enabled.\nguidance: |\n  To address this issue:\n  1. Add a `SECURITY.md` file to your repository:\n     - Ensure it includes instructions for reporting vulnerabilities, including contact details and a clear process.\n     - Refer to [GitHub\'s documentation on SECURITY.md](https://docs.github.com/en/code-security).\n  2. Alternatively, enable GitHub\'s private vulnerability reporting:\n     - Navigate to the repository\'s "Settings" \u2192 "Security and Analysis."\n     - Enable "Private vulnerability reporting."\ndef:\n  in_entity: repository\n  rule_schema: {}\n  ingest:\n    type: git\n  eval:\n    type: rego\n    data_sources:\n      - name: ghapi\n    rego:\n      type: deny-by-default\n      def: |\n        package minder\n\n        import rego.v1\n        default allow := false\n\n        ######################################################################\n        # ALLOW if there\'s a SECURITY.md file with the word "report"\n        ######################################################################\n        allow if {\n          # List any file starting with SECURITY (e.g. SECURITY.md, SECURITY.txt)\n          files := file.ls_glob("./SECURITY*")\n          count(files) > 0\n\n          # Read the first matching file\'s content\n          content := lower(file.read(files[0]))\n\n          # Check if "report" is in the file content\n          contains(content, "report")\n        }\n\n        ######################################################################\n        # ALLOW if GitHub private vulnerability reporting is enabled\n        ######################################################################\n        allow if {\n          # Query the GitHub API to check private vulnerability reporting\n          out = minder.datasource.ghapi.private_vuln_reporting({\n            "owner": input.properties["github/repo_owner"],\n            "repo":  input.properties["github/repo_name"]\n          })\n\n          # out.body.enabled == true if private vulnerability reporting is turned on\n          out.body.enabled == true\n        }\n'})}),"\n",(0,r.jsx)(n.h4,{id:"rule-evaluation-in-action",children:"Rule Evaluation In Action"}),"\n",(0,r.jsxs)(n.p,{children:["When the ",(0,r.jsx)(n.strong,{children:"osps-vm-05"})," rule is evaluated, Minder (a.k.a. Stacklok Insight) executes the following steps to determine whether there is a clear way for end-users to report vulnerabilities in the repository:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ingestion"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ingest: { type: git }"})," indicates this rule runs on a Git-based repository, allowing you to check for the existence of files like ",(0,r.jsx)(n.code,{children:"SECURITY.md"})," by first copying the repository\u2019s content."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Data Sources"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"data_sources: - name: ghapi"})," tells Minder to make the ",(0,r.jsx)(n.code,{children:"ghapi"})," data source available within this rule."]}),"\n",(0,r.jsxs)(n.li,{children:["In your Rego code, you call the ",(0,r.jsx)(n.code,{children:"private_vuln_reporting"})," endpoint by referencing ",(0,r.jsx)(n.code,{children:"minder.datasource.ghapi.private_vuln_reporting(...)"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Rego Logic"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The rule sets ",(0,r.jsx)(n.code,{children:"default allow := false"}),", meaning the repository fails this check by default."]}),"\n",(0,r.jsxs)(n.li,{children:["The repository ",(0,r.jsx)(n.em,{children:"passes"})," if ",(0,r.jsx)(n.em,{children:"either"})," of these conditions is true:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Condition A"}),": A ",(0,r.jsx)(n.code,{children:"SECURITY.md"})," file (or similar) containing \u201creport\u201d is present."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Condition B"}),": GitHub\u2019s \u201cprivate vulnerability reporting\u201d feature is enabled (via the GitHub API check)."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Violations"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If neither condition is satisfied, the rule remains in a \u201cdeny\u201d state, and Minder surfaces that as a violation, indicating the repository lacks a clear vulnerability reporting process."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(96540);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);