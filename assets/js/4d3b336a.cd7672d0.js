"use strict";(self.webpackChunkminder_docs=self.webpackChunkminder_docs||[]).push([[9393],{35475:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"run_minder_server/installing_minder","title":"Installing Minder with Helm","description":"Keycloak installation","source":"@site/docs/run_minder_server/installing_minder.md","sourceDirName":"run_minder_server","slug":"/run_minder_server/installing_minder","permalink":"/run_minder_server/installing_minder","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"title":"Installing Minder with Helm","sidebar_label":"Installing a production version","sidebar_position":20},"sidebar":"minder","previous":{"title":"Installing a development version","permalink":"/run_minder_server/run_the_server"},"next":{"title":"Configure a provider","permalink":"/run_minder_server/config_provider"}}');var r=t(74848),s=t(28453);const d={title:"Installing Minder with Helm",sidebar_label:"Installing a production version",sidebar_position:20},l=void 0,c={},o=[{value:"Keycloak installation",id:"keycloak-installation",level:2},{value:"Getting started with Keycloak",id:"getting-started-with-keycloak",level:3},{value:"PostgreSQL installation",id:"postgresql-installation",level:2},{value:"Best practices for database deployment",id:"best-practices-for-database-deployment",level:3},{value:"Ingress configuration",id:"ingress-configuration",level:2},{value:"GitHub OAuth application",id:"github-oauth-application",level:2},{value:"Helm chart parameters",id:"helm-chart-parameters",level:2},{value:"Minder",id:"minder",level:3},{value:"Requirements",id:"requirements",level:3},{value:"Values",id:"values",level:3}];function a(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.h2,{id:"keycloak-installation",children:"Keycloak installation"}),"\n",(0,r.jsx)(i.p,{children:"Minder is designed to operate without storing user credentials or personal\ninformation. To achieve this, it relies on an external identity provider. While\nMinder is compatible with any OpenID Connect (OIDC)-enabled identity provider,\nwe have thoroughly tested it with Keycloak and thus recommend it for a seamless\nintegration."}),"\n",(0,r.jsx)(i.h3,{id:"getting-started-with-keycloak",children:"Getting started with Keycloak"}),"\n",(0,r.jsx)(i.p,{children:"To install Keycloak as your identity provider, please refer to the following\nresources for detailed instructions:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Keycloak Operator Installation guide:\n",(0,r.jsx)(i.a,{href:"https://www.keycloak.org/operator/installation",children:"Keycloak Operator Installation"})]}),"\n",(0,r.jsxs)(i.li,{children:["Keycloak Tutorials for Beginners:\n",(0,r.jsx)(i.a,{href:"https://keycloak.ch/keycloak-tutorials/tutorial-1-installing-and-running-keycloak/",children:"Keycloak Tutorials"})]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"After the installation of Keycloak, there are specific settings and\nconfigurations required for Minder to function properly:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Realm configuration:"})," Set up a dedicated realm in Keycloak for Minder's\nuse."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Client setup:"})," Create two separate clients within the realm:","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"minder-cli:"})," A client for command-line interactions."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"minder-server:"})," A client for server-side operations."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["Identity provider linkage: Connect your chosen identity orovider (e.g.,\nGitHub, Google) to Keycloak. To facilitate this process, you may use the\ninitialization script available at\n",(0,r.jsx)(i.a,{href:"https://github.com/mindersec/minder/blob/main/identity/scripts/initialize.sh",children:"Minder Identity Initialization Script"}),"."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"postgresql-installation",children:"PostgreSQL installation"}),"\n",(0,r.jsx)(i.p,{children:"Minder requires a dedicated PostgreSQL database to store its operational data.\nThe database must have a dedicated user with the necessary privileges and\ncredentials."}),"\n",(0,r.jsx)(i.h3,{id:"best-practices-for-database-deployment",children:"Best practices for database deployment"}),"\n",(0,r.jsx)(i.p,{children:"It is recommended to use two distinct database users:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"One for the Minder server operations."}),"\n",(0,r.jsx)(i.li,{children:"Another solely for database migrations."}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["You can find our database migration scripts at\n",(0,r.jsx)(i.a,{href:"https://github.com/mindersec/minder/tree/main/database/migrations",children:"Minder database migrations"}),"."]}),"\n",(0,r.jsx)(i.h2,{id:"ingress-configuration",children:"Ingress configuration"}),"\n",(0,r.jsx)(i.p,{children:"Your ingress controller must be capable of handling both gRPC and HTTP/1\nprotocols."}),"\n",(0,r.jsx)(i.p,{children:"Minder exposes both HTTP and gRPC APIs, and our default Helm chart configuration\nenables ingress for both protocols. If your ingress solution requires different\nsettings, please disable the default ingress in the Helm chart and configure it\nmanually to meet your environment's needs."}),"\n",(0,r.jsx)(i.h2,{id:"github-oauth-application",children:"GitHub OAuth application"}),"\n",(0,r.jsx)(i.p,{children:"For Minder to interact with GitHub repositories, a GitHub OAuth2 application is\nrequired. This is essential for Minder's operation, as it will use this\napplication to authenticate and perform actions on GitHub repositories."}),"\n",(0,r.jsx)(i.p,{children:"Please ensure the following secrets are securely stored and handled, as they\ncontain sensitive information crucial for the authentication and operation of\nMinder's integrations:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsxs)(i.strong,{children:[(0,r.jsx)(i.code,{children:"minder-identity-secrets"}),":"]})," a secret with the key identity_client_secret\nand the value being the keycloak minder-server client secret."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsxs)(i.strong,{children:[(0,r.jsx)(i.code,{children:"minder-auth-secrets"}),":"]})," a secret with the key token_key_passphrase and\nunique content, used to encrypt tokens in the database."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsxs)(i.strong,{children:[(0,r.jsx)(i.code,{children:"minder-github-secrets"}),":"]})," a secret with the keys client_id and\nclient_secret that contains the GitHub OAuth app secrets."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"helm-chart-parameters",children:"Helm chart parameters"}),"\n",(0,r.jsx)(i.h3,{id:"minder",children:"Minder"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.img,{src:"https://img.shields.io/badge/Version-0.1.0-informational?style=flat-square",alt:"Version: 0.1.0"}),"\n",(0,r.jsx)(i.img,{src:"https://img.shields.io/badge/Type-application-informational?style=flat-square",alt:"Type: application"}),"\n",(0,r.jsx)(i.img,{src:"https://img.shields.io/badge/AppVersion-2023--07--31-informational?style=flat-square",alt:"AppVersion: 2023-07-31"})]}),"\n",(0,r.jsx)(i.p,{children:"Deploy Minder on Kubernetes"}),"\n",(0,r.jsx)(i.h3,{id:"requirements",children:"Requirements"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Repository"}),(0,r.jsx)(i.th,{children:"Name"}),(0,r.jsx)(i.th,{children:"Version"})]})}),(0,r.jsx)(i.tbody,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"oci://registry-1.docker.io/bitnamicharts"}),(0,r.jsx)(i.td,{children:"common"}),(0,r.jsx)(i.td,{children:"2.x.x"})]})})]}),"\n",(0,r.jsx)(i.h3,{id:"values",children:"Values"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Key"}),(0,r.jsx)(i.th,{children:"Type"}),(0,r.jsx)(i.th,{children:"Default"}),(0,r.jsx)(i.th,{children:"Description"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"aws.accountID"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"123456789012"'})}),(0,r.jsx)(i.td,{children:"AWS account ID where the service will be deployed"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"aws.migrate.iamRole"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"minder_migrate_role"'})}),(0,r.jsx)(i.td,{children:"IAM role for the migration operations in AWS"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"aws.server.iamRole"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"minder_server_role"'})}),(0,r.jsx)(i.td,{children:"IAM role for the server operations in AWS"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"db.host"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"postgres.postgres"'})}),(0,r.jsx)(i.td,{children:"Hostname for the database where Minder will store its data"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"deploymentSettings.extraVolumeMounts"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"nil"})}),(0,r.jsx)(i.td,{children:"Additional volume mounts for the deployment"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"deploymentSettings.extraVolumes"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"nil"})}),(0,r.jsx)(i.td,{children:"Additional volumes to mount into the deployment"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"deploymentSettings.image"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"ko://github.com/mindersec/minder/cmd/server"'})}),(0,r.jsx)(i.td,{children:"Image to use for the main Minder deployment"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"deploymentSettings.imagePullPolicy"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"IfNotPresent"'})}),(0,r.jsx)(i.td,{children:"Image pull policy for the main deployment"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"deploymentSettings.resources"}),(0,r.jsx)(i.td,{children:"object"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{"limits":{"cpu":4,"memory":"1.5Gi"},"requests":{"cpu":1,"memory":"1Gi"}}'})}),(0,r.jsx)(i.td,{children:"Compute resource requests and limits for the main deployment"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"deploymentSettings.secrets"}),(0,r.jsx)(i.td,{children:"object"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{"appSecretName":"minder-github-secrets","authSecretName":"minder-auth-secrets","identitySecretName":"minder-identity-secrets"}'})}),(0,r.jsx)(i.td,{children:"Names of the secrets for various Minder components"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"hostname"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"minder.example.com"'})}),(0,r.jsx)(i.td,{children:"The hostname for the Minder service"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"hpaSettings.maxReplicas"}),(0,r.jsx)(i.td,{children:"int"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"1"})}),(0,r.jsx)(i.td,{children:"Maximum number of replicas for HPA"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"hpaSettings.metrics"}),(0,r.jsx)(i.td,{children:"object"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{"cpu":{"targetAverageUtilization":60}}'})}),(0,r.jsx)(i.td,{children:"Target CPU utilization percentage for HPA to scale"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"hpaSettings.minReplicas"}),(0,r.jsx)(i.td,{children:"int"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"1"})}),(0,r.jsx)(i.td,{children:"Minimum number of replicas for HPA"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"ingress.annotations"}),(0,r.jsx)(i.td,{children:"object"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"{}"})}),(0,r.jsx)(i.td,{children:"Ingress annotations"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"migrationSettings.image"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"ko://github.com/mindersec/minder/cmd/server"'})}),(0,r.jsx)(i.td,{children:"Image to use for the migration jobs"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"migrationSettings.imagePullPolicy"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"IfNotPresent"'})}),(0,r.jsx)(i.td,{children:"Image pull policy for the migration jobs"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"migrationSettings.resources"}),(0,r.jsx)(i.td,{children:"object"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'{"limits":{"cpu":1,"memory":"300Mi"},"requests":{"cpu":"200m","memory":"200Mi"}}'})}),(0,r.jsx)(i.td,{children:"Compute resource requests and limits for the migration jobs"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"service.grpcPort"}),(0,r.jsx)(i.td,{children:"int"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"8090"})}),(0,r.jsx)(i.td,{children:"GRPC port for the service to listen on"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"service.httpPort"}),(0,r.jsx)(i.td,{children:"int"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"8080"})}),(0,r.jsx)(i.td,{children:"HTTP port for the service to listen on"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"service.metricPort"}),(0,r.jsx)(i.td,{children:"int"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"9090"})}),(0,r.jsx)(i.td,{children:"Metrics port for the service to expose metrics on"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"serviceAccounts.migrate"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'""'})}),(0,r.jsx)(i.td,{children:"ServiceAccount to be used for migration. If set, Minder will use this named ServiceAccount."})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"serviceAccounts.server"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'""'})}),(0,r.jsx)(i.td,{children:"ServiceAccount to be used by the server. If set, Minder will use this named ServiceAccount."})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"trusty.endpoint"}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:'"https://api.trustypkg.dev"'})}),(0,r.jsx)(i.td,{children:"Endpoint for the Stacklok Insight service which Minder communicates with"})]})]})]})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,i,t)=>{t.d(i,{R:()=>d,x:()=>l});var n=t(96540);const r={},s=n.createContext(r);function d(e){const i=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),n.createElement(s.Provider,{value:i},e.children)}}}]);