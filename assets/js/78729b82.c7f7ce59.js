"use strict";(self.webpackChunkminder_docs=self.webpackChunkminder_docs||[]).push([[106],{24094:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"developer_guide/feature_flags","title":"Using feature flags","description":"Minder is using OpenFeature for feature flags. For","source":"@site/docs/developer_guide/feature_flags.md","sourceDirName":"developer_guide","slug":"/developer_guide/feature_flags","permalink":"/developer_guide/feature_flags","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"title":"Using feature flags","sidebar_label":"Feature flags","sidebar_position":20},"sidebar":"minder","previous":{"title":"Get hacking","permalink":"/developer_guide/get-hacking"},"next":{"title":"Adding users to your project","permalink":"/user_management/adding_users"}}');var r=t(74848),s=t(28453);const i={title:"Using feature flags",sidebar_label:"Feature flags",sidebar_position:20},o=void 0,l={},c=[{value:"When to use feature flags",id:"when-to-use-feature-flags",level:2},{value:"Inappropriate use of feature flags",id:"inappropriate-use-of-feature-flags",level:3},{value:"How to use feature flags",id:"how-to-use-feature-flags",level:2},{value:"Using flags during development",id:"using-flags-during-development",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Minder is using ",(0,r.jsx)(n.a,{href:"https://openfeature.dev/",children:"OpenFeature"})," for feature flags. For\nmore complex configuration, refer to that documentation. With that said, our\ngoals are to allow for ",(0,r.jsx)(n.em,{children:"simple, straightforward"})," usage of feature flags to\n",(0,r.jsx)(n.strong,{children:"allow merging code which is complete before the entire feature is complete"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"when-to-use-feature-flags",children:"When to use feature flags"}),"\n",(0,r.jsx)(n.p,{children:"Appropriate usages of feature flags:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Stage Changes"}),". Use a feature flag to (for example) add the ability to\nwrite values in one PR, and the ability to operate on them in another PR. By\nputting all the functionality behind a feature flag, it can be released all at\nonce (when the documentation is complete). Depending on the functionality,\nthis may also be used to achieve a ",(0,r.jsx)(n.strong,{children:"staged rollout"})," across a larger\npopulation of users, starting with people willing to beta-test the feature."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Kill Switch"}),". For features which introduce new load (e.g. 10x GitHub API\ntoken usage) or new access patterns (e.g. change message durability), feature\nflags can provide a quick way to be able to enable or revert changes without\nneeding to build and push a new binary or config option (particularly if other\ncode has changed in the meantime). In this case, feature flags provide a\nconsistent way of managing configuration as an alternative to\n",(0,r.jsx)(n.code,{children:"internal/config/server"}),". Note that ",(0,r.jsx)(n.em,{children:"feature flags"})," affect a particular\ninvocation (based on the user or project in question), while ",(0,r.jsx)(n.em,{children:"config"}),"\ngenerally affects all behavior of the server."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Feature acceptance testing"})," (A/B testing). When running Minder as a\nservice, the Stacklok team may want to perform large-scale evaluation of\nwhether a feature is useful to end-users. Feature flags can allow comparing\nthe usage of two groups with and without the feature enabled."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"inappropriate-use-of-feature-flags",children:"Inappropriate use of feature flags"}),"\n",(0,r.jsx)(n.p,{children:'We expect that feature flags will generally be short-lived (a few months in most\ncases). There are costs (testing, maintenance, complexity, and general\nopportunity costs) to maintaining two code paths, so we aim to retire feature\nflags once the feature is considered "stable". Here are some examples of\nalternative mechanisms to use for long-term behavior changes:'}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Server configuration"}),". See\n",(0,r.jsx)(n.a,{href:"https://github.com/mindersec/minder/tree/main/internal/config/server",children:(0,r.jsx)(n.code,{children:"internal/config/server"})}),"\nfor long-term options that should be on or off at server startup and don't\nneed to change based on the invocation."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Entitlements"}),". See\n",(0,r.jsx)(n.a,{href:"https://github.com/mindersec/minder/tree/main/internal/projects/features",children:(0,r.jsx)(n.code,{children:"internal/projects/features"})}),"\nfor functionality that should be able to be turned on or off on a per-project\nbasis (for example, for paid customers)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"how-to-use-feature-flags",children:"How to use feature flags"}),"\n",(0,r.jsxs)(n.p,{children:["If you're working on a new Minder feature and want to merge it incrementally,\ncheck out\n",(0,r.jsx)(n.a,{href:"https://github.com/mindersec/minder/blob/d8f7d5709540bd33a2200adc2dbd330bbeceae86/internal/controlplane/handlers_authz.go#L222",children:"this code (linked to commit)"}),"\nfor an example. The process is basically:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add a feature flag declaration to\n",(0,r.jsx)(n.a,{href:"https://github.com/mindersec/minder/blob/main/internal/flags/constants.go",children:(0,r.jsx)(n.code,{children:"internal/flags/constants.go"})})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["At the call site(s), put the new functionality behind\n",(0,r.jsx)(n.code,{children:"if flags.Bool(ctx, s.featureFlags, flags.MyFlagName) {..."})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You can use the\n",(0,r.jsx)(n.a,{href:"https://github.com/mindersec/minder/blob/main/internal/flags/test_client.go",children:(0,r.jsx)(n.code,{children:"flags.FakeClient"})}),"\nin tests to test the new code path as well as the old one."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Using ",(0,r.jsx)(n.code,{children:"flags.Bool"})," from our own repo will enable a couple bits of default\nbehavior over OpenFeature:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:['We enforce that the default value of the flag is "off", so you can\'t end up\nwith the confusing ',(0,r.jsx)(n.code,{children:"disable_feature=false"})," in a config."]}),"\n",(0,r.jsxs)(n.li,{children:["We extract the user, project, and provider from ",(0,r.jsx)(n.code,{children:"ctx"}),", so you don't need to."]}),"\n",(0,r.jsx)(n.li,{children:"Eventually, we'll also record the flag settings in our telemetry records (WIP)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"using-flags-during-development",children:"Using flags during development"}),"\n",(0,r.jsxs)(n.p,{children:["You can create a ",(0,r.jsx)(n.code,{children:"flags-config.yaml"})," in the root Minder directory when running\nwith ",(0,r.jsx)(n.code,{children:"make run-docker"}),", and the file (and future changes) will be mapped into\nthe Minder container, so you can make changes live. The ",(0,r.jsx)(n.code,{children:"flags-config.yaml"})," uses\nthe\n",(0,r.jsx)(n.a,{href:"https://gofeatureflag.org/docs/configure_flag/flag_format",children:"GoFeatureFlag format"}),",\nand is in the repo's ",(0,r.jsx)(n.code,{children:".gitignore"}),", so you don't need to worry about accidentally\nchecking it in. Note that the Minder server currently rechecks the flag\nconfiguration once a minute, so it may take a minute or two for flags changes to\nbe visible."]}),"\n",(0,r.jsxs)(n.p,{children:["When deploying as a Helm chart, you can create a ConfigMap named ",(0,r.jsx)(n.code,{children:"minder-flags"}),"\ncontaining a key ",(0,r.jsx)(n.code,{children:"flags-config.yaml"}),", and it will be mounted into the container.\nAgain, changes to the ",(0,r.jsx)(n.code,{children:"minder-flags"})," ConfigMap will be updated in the Minder\nserver within about 2 minutes of update."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(96540);const r={},s=a.createContext(r);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);